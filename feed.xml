<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.2.2">Jekyll</generator><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/" rel="alternate" type="text/html" /><updated>2022-06-09T10:23:39+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/feed.xml</id><title type="html">wjohn1483.github.io</title><subtitle></subtitle><author><name>Your Name</name></author><entry><title type="html">Python loggingä»‹ç´¹</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/06/04/python-logging-introduction/" rel="alternate" type="text/html" title="Python loggingä»‹ç´¹" /><published>2022-06-04T00:00:00+00:00</published><updated>2022-06-04T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/06/04/python-logging-introduction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/06/04/python-logging-introduction/"><![CDATA[<p>é€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹ä¸€ä¸‹python loggingé€™å€‹packageçš„ä½¿ç”¨æ–¹æ³•ã€‚</p>

<!--more-->

<p>åœ¨pythonè£¡é¢æƒ³è¦å»debugä½ çš„ç¨‹å¼é™¤äº†ä½¿ç”¨<code class="language-plaintext highlighter-rouge">print()</code>ç›´æ¥æŠŠè®Šæ•¸å°å‡ºä¾†ä»¥å¤–ï¼Œå¯ä»¥ä½¿ç”¨åŸç”Ÿçš„<code class="language-plaintext highlighter-rouge">logging</code> packageä¾†å»æŠŠlogçµ¦å°å‡ºä¾†ã€‚</p>

<h2 id="logçš„åˆ†é¡">Logçš„åˆ†é¡</h2>

<p>åœ¨é–‹å§‹ä»‹ç´¹loggingæ€éº¼ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘å€‘å¯ä»¥å…ˆä¾†èªè­˜ä¸€ä¸‹logæœ‰åˆ†æˆä¸åŒçš„ç­‰ç´šï¼Œåœ¨<a href="https://docs.python.org/3/howto/logging.html#when-to-use-logging">pythonçš„æ–‡ä»¶</a>ä¸­æœ‰ä»‹ç´¹ä»€éº¼æ™‚å€™è©²ä½¿ç”¨å“ªç¨®æ–¹æ³•ä¾†é¡¯ç¤ºè¨Šæ¯ï¼Œåƒæ˜¯<code class="language-plaintext highlighter-rouge">print()</code>ä¸»è¦æ˜¯ç”¨ä¾†é¡¯ç¤ºusageç­‰ä¸€èˆ¬ç”¨é€”ï¼Œè€Œ<code class="language-plaintext highlighter-rouge">logging.warning()</code>æ˜¯è¡¨ç¤ºç™¼ç¾åˆ°æœ‰å•é¡Œï¼Œä½†ä¸¦ä¸å½±éŸ¿åŸ·è¡Œï¼Œè©³ç´°çš„ä»‹ç´¹å»ºè­°é–±è®€ä¸Šé¢çš„æ–‡ä»¶ï¼Œåº•ä¸‹ç°¡å–®ä»‹ç´¹ä¸€ä¸‹logçš„åˆ†ç´šã€‚</p>

<ul>
  <li>
    <p>DEBUGï¼šé¡¯ç¤ºè©³ç´°çš„è¨Šæ¯ï¼Œä¸»è¦æ˜¯åœ¨è¿½æŸ¥å•é¡Œçš„æ™‚å€™ä½¿ç”¨</p>
  </li>
  <li>
    <p>INFOï¼šé¡¯ç¤ºç¢ºèªçš„è¨Šæ¯ï¼Œè¡¨ç¤ºç¨‹å¼æœ‰æ­£ç¢ºåœ°åœ¨åŸ·è¡Œ</p>
  </li>
  <li>
    <p>WARNINGï¼šè¡¨ç¤ºæœ‰äº›é æ–™å¤–çš„äº‹æƒ…ç™¼ç”Ÿæˆ–é å‘Šå¯èƒ½çš„å•é¡Œåƒæ˜¯ç¡¬ç¢Ÿç©ºé–“å¿«ä¸å¤ äº†ï¼Œä½†ç¨‹å¼ä»å¯ä»¥ç¹¼çºŒåŸ·è¡Œ</p>
  </li>
  <li>
    <p>ERRORï¼šç¨‹å¼åŸ·è¡Œçš„éç¨‹ç•¶ä¸­ç¢°åˆ°äº†ä¸€äº›å•é¡Œï¼Œå¯èƒ½æœ‰äº›functionä¸èƒ½è¢«åŸ·è¡Œäº†</p>
  </li>
  <li>
    <p>CRITICALï¼šç¨‹å¼ç¢°åˆ°äº†æ›´åš´é‡çš„å•é¡Œï¼Œå·²ç¶“ç„¡æ³•ç¹¼çºŒåŸ·è¡Œ</p>
  </li>
</ul>

<h2 id="ç°¡å–®ä½¿ç”¨logging">ç°¡å–®ä½¿ç”¨logging</h2>

<p>åœ¨<code class="language-plaintext highlighter-rouge">logging</code>è£¡é¢æœ‰æ ¹æ“šä¸Šè¿°ä¸åŒç­‰ç´šçš„logæœ‰å°æ‡‰çš„functionå¯ä»¥å‘¼å«ï¼Œå¯ä»¥çœ‹åº•ä¸‹çš„ä¾‹å­</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Info message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"Warning message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">"Error message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">critical</span><span class="p">(</span><span class="s">"Critical message"</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨å¯¦éš›åŸ·è¡Œä¸Šé¢çš„ç¨‹å¼ç¢¼ä»¥å¾Œæˆ‘å€‘å¯ä»¥å¾—åˆ°ä¸‹é¢çš„çµæœ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WARNING:root:Warning message
ERROR:root:Error message
CRITICAL:root:Critical message
</code></pre></div></div>

<p>åœ¨ä½¿ç”¨<code class="language-plaintext highlighter-rouge">logging</code>çš„functionæ™‚ï¼Œ<code class="language-plaintext highlighter-rouge">logging</code>æœƒå»å‰µå»ºä¸€å€‹åå«<code class="language-plaintext highlighter-rouge">root</code>çš„loggerï¼Œä¸¦æŠŠè¨Šæ¯é€éé€™å€‹loggerä¾†ç´€éŒ„ï¼Œè€Œå…¶é è¨­çš„æ ¼å¼æ˜¯<code class="language-plaintext highlighter-rouge">severity:logger name:message</code>ï¼Œè€Œä¸”åªæœƒé¡¯ç¤ºWARNINGä»¥ä¸Šçš„è¨Šæ¯ï¼Œå¦‚æœæƒ³è¦è¨­å®šé¡¯ç¤ºå“ªç¨®logçš„ç­‰ç´šçš„è©±ï¼Œå¯ä»¥åœ¨æœ€å‰é¢å‘¼å«<code class="language-plaintext highlighter-rouge">basicConcig()</code>ä¾†è¨­å®š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"Debug message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Info message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"Warning message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">"Error message"</span><span class="p">)</span>
<span class="n">logging</span><span class="p">.</span><span class="n">critical</span><span class="p">(</span><span class="s">"Critical message"</span><span class="p">)</span>
</code></pre></div></div>

<p>æ­¤æ™‚å¾—åˆ°çš„çµæœæœƒæ˜¯</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEBUG:root:Debug message
INFO:root:Info message
WARNING:root:Warning message
ERROR:root:Error message
CRITICAL:root:Critical message
</code></pre></div></div>

<p>é€™æ¨£çš„ä½œæ³•åœ¨ç•¶ç¨‹å¼ç¢¼è£¡é¢æœ‰å¼•å…¥å¤šå€‹moduleçš„æ™‚å€™ä¹Ÿé©ç”¨</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.py
</span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"info from main"</span><span class="p">)</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s">"error from main"</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib.py
</span><span class="kn">import</span> <span class="nn">logging</span>


<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"info from lib"</span><span class="p">)</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s">"error from lib"</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢æˆ‘å€‘å¯«äº†å…©å€‹python scriptï¼Œåˆ†åˆ¥ç‚º<strong>main.py</strong>å’Œ<strong>lib.py</strong>ï¼Œå…¶ä¸­<strong>main.py</strong>æœƒå»å‘¼å«å®šç¾©åœ¨<strong>lib.py</strong>è£¡é¢çš„<code class="language-plaintext highlighter-rouge">func()</code>ï¼Œé€™æ™‚å¦‚æœå»åŸ·è¡Œ<strong>main.py</strong>çš„è©±æœƒå¾—åˆ°ä¸‹é¢çš„çµæœ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:root:info from main
ERROR:root:error from main
INFO:root:info from lib
ERROR:root:error from lib
</code></pre></div></div>

<p>åœ¨<strong>lib.py</strong>è£¡é¢è¨­å®šçš„è¨Šæ¯ä¹Ÿä¸€æ¨£æœƒè¢«é¡¯ç¤ºå‡ºä¾†ï¼Œç„¶è€Œç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œå¦‚æœæˆ‘å€‘æ²’æœ‰ç‰¹æ„åœ¨logè£¡é¢ç•™ä¸‹è·Ÿæª”æ¡ˆæœ‰é—œçš„è¨Šæ¯çš„è©±ï¼Œå°±å¾ˆé›£å¾logè£¡é¢çœ‹å‡ºé€™å€‹æ˜¯å¾å“ªè£¡ç”¢ç”Ÿå‡ºä¾†çš„logäº†ï¼Œåº•ä¸‹æœƒä»‹ç´¹pythonæ–‡ä»¶ç•¶ä¸­æ¯”è¼ƒå»ºè­°ï¼Œç‚ºæ¯å€‹æª”æ¡ˆå»ºç«‹loggerçš„æ–¹æ³•ã€‚</p>

<h2 id="ä½¿ç”¨è¤‡æ•¸logger">ä½¿ç”¨è¤‡æ•¸logger</h2>

<p>åœ¨ä¸Šé¢æˆ‘å€‘ç¢°åˆ°äº†ç„¡æ³•è¾¨åˆ¥logæ˜¯å¾å“ªå€‹moduleç”¢ç”Ÿå‡ºä¾†çš„å•é¡Œï¼Œè€Œè§£æ±ºé€™å€‹å•é¡Œçš„<a href="https://docs.python.org/3/howto/logging.html#advanced-logging-tutorial">å»ºè­°åšæ³•</a>æ˜¯å°æ¯ä¸€å€‹moduleéƒ½å»ºç«‹å°ˆå±¬æ–¼ä»–å€‘çš„loggerï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">logging.getLogger()</code>ä¾†å»ºç«‹loggerä»¥å¾Œï¼Œå†ç”¨loggerä¾†ç´€éŒ„æˆ‘å€‘çš„è¨Šæ¯ã€‚</p>

<p>é€™é‚Šæˆ‘å€‘æŠŠä¸Šé¢ä¾‹å­ä¸­çš„<code class="language-plaintext highlighter-rouge">logging</code>éƒ½æ›¿æ›æˆ<code class="language-plaintext highlighter-rouge">logger</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.py
</span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"info from main"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s">"error from main"</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># lib.py
</span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"info from lib"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s">"error from lib"</span><span class="p">)</span>
</code></pre></div></div>

<p>é€™é‚Šæˆ‘å€‘å°‡<code class="language-plaintext highlighter-rouge">__name__</code>å‚³å…¥<code class="language-plaintext highlighter-rouge">logging.getLogger()</code>ç•¶ä¸­ï¼Œé€™æ™‚loggingå°±æœƒå¹«æˆ‘å€‘å»ºç«‹ä¸€å€‹ä»¥<code class="language-plaintext highlighter-rouge">__name__</code>ç‚ºåç¨±çš„loggerï¼Œè€Œ<code class="language-plaintext highlighter-rouge">__name__</code>æœƒåœ¨pythonè£¡é¢è¢«ä»£æ›æˆæª”æ¡ˆåç¨±ï¼Œé€™æ™‚å†åŸ·è¡Œ<strong>main.py</strong>å°±èƒ½å¾—åˆ°ä»¥ä¸‹çš„çµæœ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO:__main__:info from main
ERROR:__main__:error from main
INFO:lib:info from lib
ERROR:lib:error from lib
</code></pre></div></div>

<p>å¦‚æ­¤ä¾¿èƒ½æ–¹ä¾¿åœ°çŸ¥é“é€™å€‹logæ˜¯å¾å“ªå€‹moduleç”¢ç”Ÿçš„äº†ã€‚</p>

<h2 id="loggerçš„éšå±¤">Loggerçš„éšå±¤</h2>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­è£¡é¢æˆ‘å€‘å»ºç«‹äº†å…©å€‹loggerï¼Œåˆ†åˆ¥æ˜¯<code class="language-plaintext highlighter-rouge">__main__</code>å’Œ<code class="language-plaintext highlighter-rouge">lib</code>ï¼Œé€™å…©å€‹loggerä¸æœƒå„è‡ªå°‡è¨Šæ¯ç›´æ¥å°å‡ºä¾†ï¼Œè€Œæ˜¯å°‡è¨Šæ¯å‚³åˆ°ä»–å€‘ä¸Šå±¤çš„loggerï¼Œè®“ä¸Šå±¤loggerä¸­çš„handlerä¾†æ±ºå®šlogè¦æ€éº¼è¢«è™•ç†ï¼Œåœ¨é€™å€‹ä¾‹å­è£¡é¢å®ƒå€‘æœƒå°‡logå‚³çµ¦<code class="language-plaintext highlighter-rouge">root</code>é€™å€‹loggerï¼Œå†å»çœ‹<code class="language-plaintext highlighter-rouge">root</code>è£¡é¢çš„handlerçš„è¨­å®šä¾†å»åšè™•ç†ï¼Œè©³ç´°çš„è™•ç†æµç¨‹å¯ä»¥åƒè€ƒ<a href="https://docs.python.org/3/howto/logging.html#logging-flow">æ–‡ä»¶</a></p>

<p><img src="https://docs.python.org/3/_images/logging_flow.png" alt="Logging Flow" /></p>

<p>é›–ç„¶åœ¨ç¨‹å¼ç¢¼è£¡é¢çœ‹èµ·ä¾†æˆ‘å€‘æ²’æœ‰ç‚ºroot loggerè¨­å®šä»»ä½•handlerï¼Œä½†å…¶å¯¦åœ¨æˆ‘å€‘å‘¼å«<code class="language-plaintext highlighter-rouge">logging.basicConfig()</code>çš„æ™‚å€™å®ƒå°±æœƒ<a href="https://docs.python.org/dev/library/logging.html#logging.basicConfig">è‡ªå‹•å¹«æˆ‘å€‘å»ºç«‹å¥½</a>ï¼Œå¦‚æœæƒ³è¦è‡ªè¡Œè¨­å®šçš„è©±ä¹Ÿå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">logging.getLogger()</code>ï¼Œåœ¨å…¶ä¸­ä¸çµ¦ä»»ä½•çš„åƒæ•¸ä¾†æ‹¿åˆ°root loggerï¼Œæ¥è‘—å†é€é<code class="language-plaintext highlighter-rouge">logger.addHandler()</code>ä¾†å»æ–°å¢handlerã€‚</p>

<h2 id="logging-format">Logging Format</h2>

<p>å¦‚æœèªªæˆ‘å€‘æƒ³è¦è‡ªå®šç¾©é¡¯ç¤ºå‡ºä¾†çš„logçš„æ ¼å¼çš„è©±ï¼Œå¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">logging.basicConfig()</code>çš„åœ°æ–¹è¨­å®šroot loggerä¸­handlerå°å‡ºlogçš„æ ¼å¼ï¼Œå› ç‚ºåº•ä¸‹çš„loggeræœƒæŠŠlogå¾€ä¸Šå‚³çµ¦root loggerï¼Œæ‰€ä»¥åªéœ€è¦åœ¨root loggerä¸­è¨­å®šå¥½ï¼Œæ‰€æœ‰å°å‡ºä¾†çš„logéƒ½æœƒæ˜¯ä¸€æ¨£çš„æ ¼å¼ã€‚</p>

<p>å‡å¦‚æˆ‘å€‘åœ¨<strong>main.py</strong>è£¡é¢å¤šåŠ å€‹åƒæ•¸</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s">"info from main"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s">"error from main"</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">log_format</span><span class="o">=</span><span class="s">"%(asctime)s %(filename)s:%(lineno)d - %(message)s"</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">log_format</span><span class="p">)</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>è€Œ<strong>lib.py</strong>ç¶­æŒä¸è®Šï¼Œé€™æ™‚å°å‡ºä¾†çš„è¨Šæ¯å°±æœƒè®Šæˆ</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2022-06-04 23:02:58,775 main.py:8 - info from main
2022-06-04 23:02:58,775 main.py:9 - error from main
2022-06-04 23:02:58,775 lib.py:6 - info from lib
2022-06-04 23:02:58,775 lib.py:7 - error from lib
</code></pre></div></div>

<p>æ›´å¤šloggingæ”¯æ´çš„attributeï¼Œå¯ä»¥çœ‹å…¶<a href="https://docs.python.org/3/library/logging.html#logrecord-attributes">å®˜æ–¹æ–‡ä»¶</a>ã€‚</p>

<h3 id="åœ¨logä¸­åŠ å…¥é¡è‰²">åœ¨logä¸­åŠ å…¥é¡è‰²</h3>

<p>å¦‚æœæƒ³åœ¨terminalè£¡é¢è®“ä¸åŒç­‰ç´šçš„logæœ‰ä¸åŒé¡è‰²çš„è©±ï¼Œå¯ä»¥åƒè€ƒå¾<a href="https://stackoverflow.com/questions/384076/how-can-i-color-python-logging-output">é€™è£¡</a>æ”¹ç·¨è€Œä¾†çš„æ–¹æ³•ï¼Œå¯«ä¸€å€‹<strong>log.py</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># log.py
</span><span class="kn">import</span> <span class="nn">logging</span>


<span class="k">class</span> <span class="nc">CustomFormatter</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">Formatter</span><span class="p">):</span>
    <span class="n">grey</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[38;20m"</span>
    <span class="n">cyan</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[36;20m"</span>
    <span class="n">light_green</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[32;20m"</span>
    <span class="n">yellow</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[33;20m"</span>
    <span class="n">red</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[31;20m"</span>
    <span class="n">bold_red</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[31;1m"</span>
    <span class="n">reset</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x1b</span><span class="s">[0m"</span>
    <span class="n">log_format</span> <span class="o">=</span> <span class="s">"%(asctime)s - %(name)s - %(levelname)s - %(message)s (%(filename)s:%(lineno)d)"</span>

    <span class="n">FORMATS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">:</span> <span class="n">light_green</span> <span class="o">+</span> <span class="n">log_format</span> <span class="o">+</span> <span class="n">reset</span><span class="p">,</span>
        <span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">:</span> <span class="n">cyan</span> <span class="o">+</span> <span class="n">log_format</span> <span class="o">+</span> <span class="n">reset</span><span class="p">,</span>
        <span class="n">logging</span><span class="p">.</span><span class="n">WARNING</span><span class="p">:</span> <span class="n">yellow</span> <span class="o">+</span> <span class="n">log_format</span> <span class="o">+</span> <span class="n">reset</span><span class="p">,</span>
        <span class="n">logging</span><span class="p">.</span><span class="n">ERROR</span><span class="p">:</span> <span class="n">red</span> <span class="o">+</span> <span class="n">log_format</span> <span class="o">+</span> <span class="n">reset</span><span class="p">,</span>
        <span class="n">logging</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">:</span> <span class="n">bold_red</span> <span class="o">+</span> <span class="n">log_format</span> <span class="o">+</span> <span class="n">reset</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">log_fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">FORMATS</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">levelno</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">log_fmt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>


<span class="n">root_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">root_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">root_handler</span><span class="p">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">CustomFormatter</span><span class="p">())</span>
<span class="n">root_logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">root_handler</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼è£¡é¢æˆ‘å€‘è‡ªè¨‚äº†ä¸€å€‹formatterï¼Œä¸¦æ ¹æ“šä¸åŒç­‰ç´šçš„logåŠ å…¥ä¸åŒé¡è‰²çš„å‰ç¶´å’Œå¾Œç¶´ï¼Œè€Œä¸”åœ¨åº•ä¸‹ä¹Ÿè¨­å®šäº†root loggerçš„handlerï¼Œè¦ä½¿ç”¨çš„æ™‚å€™æˆ‘å€‘åœ¨æ–°çš„ç¨‹å¼ç¢¼è£¡é¢ç°¡å–®importå®ƒä¸¦è¨­å®šlevelå°±å¯ä»¥äº†</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># main.py
</span><span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">log</span>
<span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">func</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="s">"debug message"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"info message"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"warning message"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="s">"error message"</span><span class="p">)</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">critical</span><span class="p">(</span><span class="s">"critical message"</span><span class="p">)</span>
    <span class="n">func</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">().</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>è·‘å‡ºä¾†çš„logå°±èƒ½æœ‰é¡è‰²äº†</p>

<p><img src="./colorful_log.png" alt="Colorful Log" /></p>

<p>ä¸éè¦å°å¿ƒçš„æ˜¯ï¼Œå¦‚æœæŠŠlogå¯«æˆæª”æ¡ˆçš„è©±ï¼Œé€™äº›é¡è‰²å‰ç¶´å’Œå¾Œç¶´éƒ½æœƒè¢«å¯«é€²æª”æ¡ˆè£¡é¢ï¼Œå»ºè­°è¦–æƒ…æ³ä¾†ä½¿ç”¨</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[32<span class="p">;</span>20m2022-06-09 18:20:41,750 - __main__ - DEBUG - debug message <span class="o">(</span>main.py:11<span class="o">)</span>[0m
[36<span class="p">;</span>20m2022-06-09 18:20:41,750 - __main__ - INFO - info message <span class="o">(</span>main.py:12<span class="o">)</span>[0m
[33<span class="p">;</span>20m2022-06-09 18:20:41,750 - __main__ - WARNING - warning message <span class="o">(</span>main.py:13<span class="o">)</span>[0m
[31<span class="p">;</span>20m2022-06-09 18:20:41,750 - __main__ - ERROR - error message <span class="o">(</span>main.py:14<span class="o">)</span>[0m
[31<span class="p">;</span>1m2022-06-09 18:20:41,750 - __main__ - CRITICAL - critical message <span class="o">(</span>main.py:15<span class="o">)</span>[0m
[36<span class="p">;</span>20m2022-06-09 18:20:41,750 - lib - INFO - info from lib <span class="o">(</span>lib.py:8<span class="o">)</span>[0m
[31<span class="p">;</span>20m2022-06-09 18:20:41,750 - lib - ERROR - error from lib <span class="o">(</span>lib.py:9<span class="o">)</span>[0m
</code></pre></div></div>]]></content><author><name>Your Name</name></author><category term="Tool" /><category term="Python" /><summary type="html"><![CDATA[é€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹ä¸€ä¸‹python loggingé€™å€‹packageçš„ä½¿ç”¨æ–¹æ³•ã€‚]]></summary></entry><entry><title type="html">MLflowä»‹ç´¹</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/29/mlflow-introduction/" rel="alternate" type="text/html" title="MLflowä»‹ç´¹" /><published>2022-05-29T00:00:00+00:00</published><updated>2022-05-29T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/29/mlflow-introduction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/29/mlflow-introduction/"><![CDATA[<p>éš¨è‘—æ©Ÿå™¨å­¸ç¿’çš„èˆˆèµ·ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººå˜—è©¦å¼•å…¥MLOpsåœ¨ç³»çµ±ç•¶ä¸­ï¼Œé€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹ä¸€ä¸‹MLflowçš„ä½¿ç”¨å¿ƒå¾—ã€‚</p>

<!--more-->

<h2 id="mlops">MLOps</h2>

<p>åœ¨é–‹å§‹ä»‹ç´¹MLflowä¹‹å‰å…ˆç°¡å–®ä»‹ç´¹ä¸€ä¸‹MLOpsæƒ³è¦åšçš„äº‹æƒ…ï¼ŒMLOpså¯ä»¥èªªè·ŸDevOpsä¸€æ¨£æ˜¯ä¸€ç¨®ç²¾ç¥ï¼Œä¸»è¦æ˜¯å¸Œæœ›èƒ½è®“Machine Learningè·ŸOperationsèƒ½å¤ åˆä½œçš„æ›´èæ´½ï¼Œé€™é‚ŠMachine Learningçš„éƒ¨åˆ†åŒ…å«äº†å°è³‡æ–™æ¸…ç†ã€å»ºç«‹ä¸¦è¨“ç·´æ¨¡å‹ã€é©—è­‰æ¨¡å‹æˆæ•ˆç­‰ç­‰çš„äº‹æƒ…ï¼Œè€ŒOperationsæŒ‡çš„æ˜¯æŠŠæ¨¡å‹éƒ¨ç½²åˆ°ç³»çµ±è£¡é¢é€²è¡Œé æ¸¬ã€‚</p>

<p><img src="https://cloud.google.com/architecture/images/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning-2-manual-ml.svg" alt="MLOps Manual Process" /></p>

<p><em><a href="https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning#devops_versus_mlops">MLOps: Continuous delivery and automation pipelines in machine learning</a></em></p>

<p>ä¸Šåœ–æ˜¯ä¸€å€‹ç°¡å–®çš„pipelineï¼Œå·¦åŠé‚ŠMLçš„éƒ¨åˆ†æ˜¯ä¸€èˆ¬machine learningçš„æµç¨‹ï¼ŒåŒ…å«äº†è³‡æ–™è™•ç†å’Œå»ºç«‹æ¨¡å‹çš„éç¨‹ï¼Œè€Œæœ€çµ‚ç”¢ç”Ÿçš„æ¨¡å‹æœƒæ”¾é€²model registryè£¡é¢ï¼ŒOperationså†å¾model registryè£¡é¢æŠŠæ¨¡å‹æ‹¿å‡ºä¾†åšservingã€‚</p>

<p>é€™å€‹pipelineç°¡å–®æœ‰æ•ˆï¼Œä½†å¦‚æœæœªä¾†æœ‰æ–°çš„è³‡æ–™é€²ä¾†æˆ–æ˜¯æ¨¡å‹çš„æˆæ•ˆé–‹å§‹ä¸‹é™ç­‰å¯èƒ½æœƒéœ€è¦é‡æ–°è¨“ç·´çš„æ¨¡å‹çš„æƒ…æ³ç™¼ç”Ÿçš„è©±ï¼ŒOperationså°±æœƒéœ€è¦å†è«‹MLçš„äººå¹«å¿™è¨“ç·´æ¨¡å‹ï¼Œç‚ºæ­¤å¦ä¸€å€‹æ¯”è¼ƒç©©å®šçš„pipelineå¯ä»¥æ˜¯å¦‚ä¸‹åœ–ã€‚</p>

<p><img src="https://cloud.google.com/architecture/images/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning-3-ml-automation-ct.svg" alt="MLOps Pipeline Automation" /></p>

<p><em><a href="https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning#devops_versus_mlops">MLOps: Continuous delivery and automation pipelines in machine learning</a></em></p>

<p>åœ¨é€™å€‹pipelineè£¡é¢ï¼ŒMLæ‰€äº¤ä»˜çš„ä¸å†æ˜¯ä¸€å€‹æ¨¡å‹ï¼Œè€Œæ˜¯ç”¢ç”Ÿå‡ºé€™å€‹æ¨¡å‹çš„pipelineï¼ŒåŒ…å«äº†è³‡æ–™é©—è­‰ã€æ¸…ç†ã€å»ºç«‹æ¨¡å‹ã€é©—è­‰æ¨¡å‹ç­‰ï¼Œè€ŒOperationsæœƒå°‡é€™å€‹pipelineéƒ¨ç½²åˆ°ç³»çµ±è£¡é¢è‡ªè¡Œå»ç”¢ç”Ÿæ¨¡å‹å‡ºä¾†ï¼Œå¦‚æœèªªæœ‰æ–°çš„è³‡æ–™æˆ–æ˜¯æœ‰éœ€è¦é‡æ–°è¨“ç·´æ¨¡å‹çš„æƒ…æ³ç™¼ç”Ÿï¼ŒOperationså°±èƒ½ç›´æ¥é‡è·‘é€™å€‹pipelineä¾†å¾—åˆ°æ–°çš„æ¨¡å‹ã€‚</p>

<p>ç„¶è€Œè¦å»ºç«‹é€™ç¨®pipelineæœƒéœ€è¦èŠ±è²»è »å¤šå·¥å¤«çš„ï¼Œè€ŒMLflowå¯ä»¥å¹«åŠ©æˆ‘å€‘é™ä½ä¸€äº›å»ºç«‹é€™ç¨®pipelineçš„å›°é›£ã€‚</p>

<h2 id="mlflow">MLflow</h2>

<p><a href="https://mlflow.org/">MLflow</a>æ˜¯ä¸€å€‹é–‹æºçš„å¹³å°ï¼Œä¸»è¦æ˜¯æ‡‰ç”¨åœ¨machine learning lifecycleç•¶ä¸­ï¼ŒMLflowåŒ…å«äº†å››å€‹éƒ¨åˆ†</p>

<ul>
  <li>
    <p>Trackingï¼šç”¨ä»¥è¨˜éŒ„åœ¨è¨“ç·´æ¨¡å‹æ˜¯æ‰€ä½¿ç”¨çš„åƒæ•¸å’Œè¨“ç·´éç¨‹ä¸­çš„ä¸€äº›metrics</p>
  </li>
  <li>
    <p>Projectsï¼šè®“ä½¿ç”¨è€…å¯ä»¥å»ºç«‹ä¸€å¥—pipelineä¾†è®“å…¶ä»–äººå¯ä»¥è¼•æ˜“åœ°é‡ç¾å‡ºæ¨¡å‹</p>
  </li>
  <li>
    <p>Modelsï¼šæŠŠæ¨¡å‹åŒ…è£èµ·ä¾†ï¼Œåœ¨è£¡é¢æœƒç´€éŒ„è®“æ¨¡å‹é‹è¡Œæ‰€éœ€è¦çš„ç’°å¢ƒå’Œæ¨¡å‹æœ¬èº«ï¼Œè®“å…¶ä»–äººæ–¹ä¾¿ç›´æ¥ä½¿ç”¨æ¨¡å‹</p>
  </li>
  <li>
    <p>Registryï¼šå­˜æ”¾æ¨¡å‹ä¸¦æ”¯æ´ç‰ˆæœ¬æ§åˆ¶</p>
  </li>
</ul>

<p>åº•ä¸‹çš„æ–‡ç« å°‡æœƒç°¡è¿°ä¸€ä¸‹Trackingå’ŒProjectsçš„éƒ¨åˆ†ã€‚</p>

<h3 id="mlflow-tracking">MLflow Tracking</h3>

<p>æˆ‘å€‘å…ˆå¿«é€Ÿçœ‹ä¸€ä¸‹åº•ä¸‹çš„ç¨‹å¼ç¢¼</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mlflow</span> <span class="kn">import</span> <span class="n">log_metric</span><span class="p">,</span> <span class="n">log_param</span><span class="p">,</span> <span class="n">log_artifact</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="c1"># Log a parameter (key-value pair)
</span>    <span class="n">log_param</span><span class="p">(</span><span class="s">"param1"</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">log_param</span><span class="p">(</span><span class="s">"param2"</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="c1"># Log a metric; metrics can be updated throughout the run
</span>    <span class="n">log_metric</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">log_metric</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">log_metric</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="c1"># Log an artifact (output file)
</span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"output1.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"first file!"</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"output2.txt"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="s">"second file!"</span><span class="p">)</span>
    <span class="n">log_artifact</span><span class="p">(</span><span class="s">"output1.txt"</span><span class="p">)</span>
    <span class="n">log_artifact</span><span class="p">(</span><span class="s">"output2.txt"</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼ä¸­æˆ‘å€‘å¯ä»¥çœ‹åˆ°mlflowæä¾›äº†ä¸‰ç¨®ä¸åŒlogçš„functionï¼Œ<code class="language-plaintext highlighter-rouge">log_param</code>ç”¨ä¾†è¨˜éŒ„é€™æ¬¡è¨“ç·´æ¨¡å‹æ™‚æ‰€ä½¿ç”¨çš„hyperparametersåƒæ˜¯learning rateã€batch sizeç­‰ç­‰ï¼Œè€Œ<code class="language-plaintext highlighter-rouge">log_metric</code>ç”¨ä¾†è¨˜éŒ„è¨“ç·´æ¨¡å‹ä¸­æœƒè®Šå‹•çš„è³‡æ–™ï¼Œåƒæ˜¯lossã€accuracyç­‰ï¼Œæœ€å¾Œ<code class="language-plaintext highlighter-rouge">log_artifact</code>æœƒæŠŠè©²è·¯å¾‘çš„æª”æ¡ˆæ”¾é€²artifactä¸­ï¼Œä¸»è¦æ˜¯æŠŠé€™æ¬¡è¨“ç·´å®Œæˆä»¥å¾Œæƒ³è¦ç•™å­˜çš„æª”æ¡ˆå„²å­˜ä¸‹ä¾†ï¼Œåƒæ˜¯æ¨¡å‹æœ¬èº«ã€å‰è™•ç†/å¾Œè™•ç†ç”¨åˆ°çš„å­—å…¸æª”ç­‰ã€‚</p>

<p>æœ‰äº†é€™äº›functionä»¥å¾Œï¼Œæˆ‘å€‘å°±èƒ½åœ¨ç·¨å¯«ç¨‹å¼çš„æ™‚å€™æŠŠé€™äº›functionå®‰æ’é€²ä¾†ï¼Œä¹‹å¾Œå°±èƒ½åœ¨command lineä¸Šé¢ä¸‹<code class="language-plaintext highlighter-rouge">mlflow server</code>çš„æŒ‡ä»¤ä¾†æ‰“é–‹mlflowçš„UIä¾†æª¢è¦–è¨“ç·´çš„æˆæœï¼Œç„¶è€Œæ¯æ¬¡æ‰‹å‹•å¯«é€™äº›functionæœ‰é»éº»ç…©ï¼Œmlflowæœ‰å¦å¤–æä¾›äº†auto trackingçš„åŠŸèƒ½ï¼Œåªéœ€è¦åœ¨ç¨‹å¼ç¢¼è£¡é¢åŠ å€‹å¹¾è¡Œï¼Œmlflowå°±æœƒå¹«ä½ è‡ªå‹•ç´€éŒ„é€™äº›åƒæ•¸å’Œçµæœäº†ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"""Trains and evaluate a simple MLP
on the Reuters newswire topic classification task.
"""</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.datasets</span> <span class="kn">import</span> <span class="n">reuters</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Activation</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>

<span class="c1"># The following import and function call are the only additions to code required
# to automatically log metrics and parameters to MLflow.
</span><span class="kn">import</span> <span class="nn">mlflow.keras</span>

<span class="n">mlflow</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="n">max_words</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Loading data..."</span><span class="p">)</span>
</code></pre></div></div>

<p><em><a href="https://github.com/mlflow/mlflow/blob/master/examples/keras/train.py">mlflow/examples/keras/train.py</a></em></p>

<p>åœ¨ä¸Šé¢æ˜¯ä¸€å€‹ç”¨kerasè¨“ç·´æ¨¡å‹çš„ç¯„ä¾‹ï¼Œåœ¨è£¡é¢æˆ‘å€‘åªéœ€è¦åŠ å…¥<code class="language-plaintext highlighter-rouge">import mlflow.keras</code>ã€<code class="language-plaintext highlighter-rouge">mlflow.keras.autolog()</code>é€™å…©è¡Œå°±èƒ½è®“mlflowå¹«æˆ‘å€‘ç´€éŒ„åƒæ•¸äº†ã€‚</p>

<p><img src="./mlflow_keras.png" alt="MLflow Keras" /></p>

<h3 id="mlflow-projects">MLflow Projects</h3>

<p>å‡å¦‚æˆ‘å€‘æƒ³è¦åˆ†äº«æˆ‘å€‘è¨“ç·´æ¨¡å‹æ‰€åšçš„æ‰€æœ‰æ­¥é©Ÿï¼Œæˆ‘å€‘å¯ä»¥å¯«ä¸€å€‹<code class="language-plaintext highlighter-rouge">MLproject</code>çš„æª”æ¡ˆï¼Œä¾†è®“å…¶ä»–äººå¯ä»¥ç°¡å–®ä¸‹ä¸€å€‹æŒ‡ä»¤<code class="language-plaintext highlighter-rouge">mlflow run .</code>å°±èƒ½é‡ç¾æ¨¡å‹è¨“ç·´çš„çµæœã€‚</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">mnist-autolog-example</span>

<span class="na">conda_env</span><span class="pi">:</span> <span class="s">conda.yaml</span>

<span class="na">entry_points</span><span class="pi">:</span>
  <span class="na">main</span><span class="pi">:</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="na">max_epochs</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">int</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">5</span><span class="pi">}</span>
      <span class="na">gpus</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">int</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">0</span><span class="pi">}</span>
      <span class="na">strategy</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type str</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="s2">"</span><span class="s">None"</span><span class="pi">}</span>
      <span class="na">batch_size</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">int</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">64</span><span class="pi">}</span>
      <span class="na">num_workers</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">int</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">3</span><span class="pi">}</span>
      <span class="na">learning_rate</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">float</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">0.001</span><span class="pi">}</span>
      <span class="na">patience</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type int</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">3</span><span class="pi">}</span>
      <span class="na">mode</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type str</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">min'</span><span class="pi">}</span>
      <span class="na">verbose</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type bool</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">True</span><span class="pi">}</span>
      <span class="na">monitor</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type str</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">val_loss'</span><span class="pi">}</span>

    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">python mnist_autolog_example.py \</span>
            <span class="s">--max_epochs {max_epochs} \</span>
            <span class="s">--gpus {gpus} \</span>
            <span class="s">--strategy {strategy} \</span>
            <span class="s">--batch_size {batch_size} \</span>
            <span class="s">--num_workers {num_workers} \</span>
            <span class="s">--lr {learning_rate} \</span>
            <span class="s">--es_patience {patience} \</span>
            <span class="s">--es_mode {mode} \</span>
            <span class="s">--es_verbose {verbose} \</span>
            <span class="s">--es_monitor {monitor}</span>
</code></pre></div></div>

<p><em><a href="https://github.com/mlflow/mlflow/blob/master/examples/pytorch/MNIST/MLproject">mlflow/examples/pytorch/MNIST/MLproject</a></em></p>

<p>MLflowåœ¨è®€å–é€™å€‹æª”æ¡ˆçš„æ™‚å€™æœƒå…ˆåœ¨condaè£¡é¢å»ºç«‹ä¸€å€‹virtual environmentï¼Œä¸¦æŒ‰ç…§<code class="language-plaintext highlighter-rouge">conda.yaml</code>çš„è¨­å®šä¾†å»å®‰è£packageå€‘ï¼Œæ¥ä¸‹ä¾†æœƒå»åŸ·è¡Œentry_pointsè£¡é¢<code class="language-plaintext highlighter-rouge">main</code>çš„éƒ¨åˆ†ï¼Œå¦‚æœèªªæƒ³è¦ä½¿ç”¨ä¸åŒçš„åƒæ•¸è©¦è©¦çœ‹çš„è©±ï¼Œå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">mlflow run . -P PARAM=VALUE</code>çš„æ–¹å¼ä¾†å»æ›¿æ›æ‰é è¨­å€¼ã€‚</p>

<p>å¦‚æœåœ¨æ•´å€‹pipelineä¸­é‚„æœ‰å…¶ä»–è³‡æ–™è™•ç†æˆ–æ¨¡å‹é©—è­‰çš„æ­¥é©Ÿï¼Œå¯ä»¥åƒè€ƒ<a href="https://github.com/mlflow/mlflow/tree/master/examples/multistep_workflow">multistep_workflow</a>çš„ç¯„ä¾‹ã€‚</p>

<h2 id="çµè«–">çµè«–</h2>

<p>è¦æŠŠæ•´å€‹pipelineåŒ…è£æˆå¯é‡è¤‡åŸ·è¡Œçš„ç¨‹å¼ç¢¼é‚„æ˜¯éœ€è¦è »å¤šå·¥å¤«çš„ï¼Œå¥½åœ¨MLflowå¯ä»¥å¹«æˆ‘å€‘çœå»ä¸€äº›ï¼Œè€Œä¸”å…¶auto trackingçš„åŠŸèƒ½ä¹Ÿå¾ˆé©åˆåœ¨åšå¯¦é©—çš„éç¨‹ç•¶ä¸­ä¾†ä½¿ç”¨ã€‚</p>

<p>å¦å¤–åœ¨å¯¦ä½œçš„éç¨‹ç•¶ä¸­å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœæƒ³è¦åœ¨auto trackingç•¶ä¸­å¦å¤–æ‰‹å‹•å­˜å…¥å…¶ä»–artifactï¼Œéœ€è¦æŠŠ<code class="language-plaintext highlighter-rouge">log_artifact</code>é€™å€‹functionæ”¾åœ¨åŒä¸€å€‹runè£¡é¢</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">with</span> <span class="n">mlflow</span><span class="p">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
    <span class="n">mlflow</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>
    <span class="c1"># Training
</span>    <span class="n">mlflow</span><span class="p">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s">"PATH_TO_ARTIFACT"</span><span class="p">)</span>
</code></pre></div></div>

<p>è€Œåœ¨pipelineè™•ç†çš„éç¨‹ä¸­ï¼Œå‡å¦‚èªªæˆ‘å€‘æœ‰å€‹entry pointæ˜¯è™•ç†è³‡æ–™ã€å¦ä¸€å€‹entry pointæ˜¯è¨“ç·´æ¨¡å‹ï¼Œæˆ‘å€‘æ‡‰è©²æœƒå¸Œæœ›æ¯æ¬¡pipelineè·‘èµ·ä¾†ä¾¿å»æª¢æŸ¥è³‡æ–™æ˜¯å¦å·²ç¶“è™•ç†å¥½äº†ï¼Œå¦‚æœå·²ç¶“è™•ç†å¥½å°±ç›´æ¥è·‘è¨“ç·´æ¨¡å‹çš„éƒ¨åˆ†å°±å¥½ï¼Œæˆ‘ç›®å‰é‚„æ²’æœ‰åœ¨MLflowçœ‹åˆ°æ¯”è¼ƒå¥½çš„çœ‹æœ‰æ²’æœ‰åŸ·è¡ŒéæŸå€‹entry pointçš„æ–¹æ³•ï¼Œå¯èƒ½é‚„æ˜¯éœ€è¦åƒå‰é¢<a href="https://github.com/mlflow/mlflow/tree/master/examples/multistep_workflow">multistep_workflow</a>çš„ç¯„ä¾‹é‚£æ¨£ï¼Œè‡ªå·±å¯«å€‹<code class="language-plaintext highlighter-rouge">main.py</code>ä¾†å»æª¢æŸ¥ã€‚</p>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ul>
  <li>
    <p><a href="https://medium.com/ai-blog-tw/%E7%B5%A6ml-engineer%E7%9A%84mlops%E7%B0%A1%E8%BF%B0-%E6%8C%81%E7%BA%8C%E9%96%8B%E7%99%BC%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92service%E7%9A%84%E9%AB%98%E6%95%88%E7%90%86%E5%BF%B5-8bd552876299">çµ¦ML Engineerçš„MLOpsç°¡è¿°: æŒçºŒé–‹ç™¼æ©Ÿå™¨å­¸ç¿’Serviceçš„é«˜æ•ˆç†å¿µ</a></p>
  </li>
  <li>
    <p><a href="https://cloud.google.com/architecture/mlops-continuous-delivery-and-automation-pipelines-in-machine-learning#devops_versus_mlops">MLOps: Continuous delivery and automation pipelines in machine learning</a></p>
  </li>
</ul>]]></content><author><name>Your Name</name></author><category term="Tool" /><summary type="html"><![CDATA[éš¨è‘—æ©Ÿå™¨å­¸ç¿’çš„èˆˆèµ·ï¼Œæœ‰è¶Šä¾†è¶Šå¤šäººå˜—è©¦å¼•å…¥MLOpsåœ¨ç³»çµ±ç•¶ä¸­ï¼Œé€™ç¯‡æ–‡ç« ç°¡å–®ä»‹ç´¹ä¸€ä¸‹MLflowçš„ä½¿ç”¨å¿ƒå¾—ã€‚]]></summary></entry><entry><title type="html">Learning Hierarchy-Aware Knowledge Graph Embeddings for Link Prediction</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/14/Learning-Hierarchy-Aware-Knowledge-Graph-Embeddings-for-Link-Prediction/" rel="alternate" type="text/html" title="Learning Hierarchy-Aware Knowledge Graph Embeddings for Link Prediction" /><published>2022-05-14T00:00:00+00:00</published><updated>2022-05-14T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/14/Learning-Hierarchy-Aware-Knowledge-Graph-Embeddings-for-Link-Prediction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/14/Learning-Hierarchy-Aware-Knowledge-Graph-Embeddings-for-Link-Prediction/"><![CDATA[<p>ç°¡å–®è¨˜éŒ„ä¸€ä¸‹çœ‹å®Œé€™ç¯‡paperçš„ç­†è¨˜ã€‚</p>

<!--more-->

<p><a href="https://arxiv.org/abs/1911.09419">é€™ç¯‡paper</a>æ˜¯AAAI 2020ä¸­è¢«ç™¼è¡¨çš„paperï¼Œç›¸è¼ƒæ–¼å…¶ä»–knowledge graphçš„paperï¼Œé€™ç¯‡paperæŠŠæ‰€æœ‰çš„entityéƒ½æ”¾é€²æ¥µåº§æ¨™ç•¶ä¸­ï¼Œå¸Œæœ›è®“æ¨¡å‹å­¸ç¿’åˆ°è¶Šå…§å±¤çš„entityæ˜¯éšå±¤ä¸­æ¯”è¼ƒé«˜çš„ï¼Œè¶Šå¤–å±¤çš„eneityæ˜¯éšå±¤ä¸­æ¯”è¼ƒä½çš„ã€‚</p>

<h2 id="hierarchy-aware-knowledge-graph-embedding-hake">Hierarchy-Aware Knowledge Graph Embedding (HAKE)</h2>

<p><img src="./model_illustration.png" alt="Model Illustration" /></p>

<h3 id="annotation">Annotation</h3>

<p>åœ¨è¼¸å…¥çµ¦æ¨¡å‹çš„è³‡æ–™ç•¶ä¸­ï¼Œä¸»è¦æœƒæ˜¯å„å€‹entityä¹‹é–“çš„relationï¼Œå¯«ä½œ<code class="language-plaintext highlighter-rouge">(head, relation, tail)</code>ï¼ŒæŒ‡å¾—æ˜¯èªª<code class="language-plaintext highlighter-rouge">head</code>å’Œ<code class="language-plaintext highlighter-rouge">tail</code>ä¹‹é–“æœ‰<code class="language-plaintext highlighter-rouge">relation</code>ï¼Œè€Œ<code class="language-plaintext highlighter-rouge">head</code>æ˜¯æ¯”è¼ƒä¸Šå±¤çš„ï¼Œä»¥ä¸Šé¢åœ–ç‰‡ä¸­çš„ä¾‹å­ä¾†èªªï¼Œå¯èƒ½çš„è³‡æ–™æœƒæ˜¯</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">(Device,</span><span class="w"> </span><span class="err">has_function,</span><span class="w"> </span><span class="err">Source)</span><span class="w">
</span><span class="err">(Device,</span><span class="w"> </span><span class="err">has_function,</span><span class="w"> </span><span class="err">Support)</span><span class="w">
</span><span class="err">(Source,</span><span class="w"> </span><span class="err">has_object,</span><span class="w"> </span><span class="err">Lamp)</span><span class="w">
</span><span class="err">(Source,</span><span class="w"> </span><span class="err">has_object,</span><span class="w"> </span><span class="err">Light)</span><span class="w">
</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>åœ¨paperè£¡é¢æˆ‘å€‘æœƒçµ¦æ¯ä¸€å€‹<code class="language-plaintext highlighter-rouge">head</code>ã€<code class="language-plaintext highlighter-rouge">relation</code>å’Œ<code class="language-plaintext highlighter-rouge">tail</code>å„ä¸€å€‹embeddingï¼Œåˆ†åˆ¥å¯«ä½œ$\mathbf{h}$ã€$\mathbf{r}$å’Œ$\mathbf{t}$ï¼Œå…¶ä¸­å› ç‚ºä½œè€…æƒ³è¦å°‡embeddingå­˜åœ¨åœ¨æ¥µåº§æ¨™ç•¶ä¸­ï¼Œæ‰€ä»¥æ¯ä¸€å€‹embeddingéƒ½æœƒå­˜åœ¨æœ‰moduluså’Œphaseçš„é€™å…©å€‹éƒ¨åˆ†ï¼Œä»¥headçš„embeddingç‚ºä¾‹ï¼Œä»–å€‘åˆ†åˆ¥æœƒè¢«å¯«ä½œ$\mathbf{h}_m$ã€$\mathbf{h}_p$ã€‚</p>

<h3 id="modulus-distance">Modulus Distance</h3>

<p>åœ¨è¨ˆç®—å…©å€‹embeddingç›¸ä¼¼æ€§çš„æ™‚å€™ï¼ŒæœƒæŠŠmoduluså’Œphaseé€™å…©å€‹éƒ¨åˆ†æ‹†é–‹ä¾†çœ‹ï¼Œæˆ‘å€‘æœƒå¸Œæœ›$\mathbf{h}_m$åœ¨ç¶“érelationçš„è½‰æ›ä»¥å¾Œï¼Œè¶Šåƒ$\mathbf{t}_m$è¶Šå¥½ï¼Œäº¦å³</p>

\[\mathbf{h}_m \circ \mathbf{r}_m = \mathbf{t}_m\]

<p>è€Œè·é›¢çš„éƒ¨åˆ†å°±æ˜¯çœ‹å¯¦éš›ä¸Šè·Ÿé æœŸçš„è½å·®æœ‰å¤šå°‘</p>

\[d_{r,m}(\mathbf{h}_m, \mathbf{t}_m)=\left\| \mathbf{h}_m\circ\mathbf{r}_m-\mathbf{t}_m\right\|_2\]

<p>å…¶ä¸­å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé›–ç„¶embeddingæœ¬èº«å¯ä»¥æœ‰è² å€¼ï¼Œä½†$\mathbf{r}_m$çš„éƒ¨åˆ†æœƒé™åˆ¶è£¡é¢æ‰€æœ‰çš„å€¼éƒ½å¿…é ˆè¦å¤§æ–¼é›¶ï¼ŒåŸå› æ˜¯å› ç‚ºæˆ‘å€‘æƒ³è¦éšå±¤æ¯”è¼ƒé«˜çš„entityåœ¨æ¥è¿‘åŸé»çš„ä½ç½®ï¼Œç”±æ–¼$[\mathbf{r}_m]_i&gt;0$çš„ç‰¹æ€§ï¼Œæ¨¡å‹æ¼¸æ¼¸åœ°å°±æœƒå°‡éšå±¤ä½çš„embeddingå¾€å¤–æ¨äº†ã€‚</p>

<h3 id="phase-distance">Phase Distance</h3>

<p>åœ¨phaseçš„éƒ¨åˆ†è·Ÿmoduluså·®ä¸å¤šï¼Œæˆ‘å€‘å¸Œæœ›$\mathbf{h}_p$åœ¨ç¶“érelationçš„è½‰æ›ä»¥å¾Œï¼Œè¶Šåƒ$\mathbf{t}_p$è¶Šå¥½</p>

\[(\mathbf{h}_p+\mathbf{r}_p)\mod 2\pi=\mathbf{t}_p,\ where\ \mathbf{h}_p,\mathbf{r}_p,\mathbf{t}_p\in[0,2\pi)^k\]

<p>è·é›¢ä¸Šä¹Ÿæ˜¯çœ‹å…©è€…ç›¸å·®å¤šå°‘</p>

\[d_{r,p}(\mathbf{h}_p, \mathbf{t}_p)=\left\| \sin((\mathbf{h}_p+\mathbf{r}_p-\mathbf{t}_p)/2)\right\|_1\]

<h3 id="loss-function">Loss Function</h3>

<p>ä¸Šé¢åˆ†åˆ¥å®šç¾©äº†modulus distanceå’Œphase distanceï¼Œå…©å€‹entityå¯¦éš›çš„è·é›¢ä¾¿å¯å®šç¾©æˆ</p>

\[d_r(\mathbf{h},\mathbf{t})=d_{r,m}(\mathbf{h}_m,\mathbf{t}_m)+\lambda d_{r,p}(\mathbf{h}_p,\mathbf{t}_p)\]

<p>å…¶ä¸­çš„$\lambda$æ˜¯ç”±modelè‡ªè¡Œå­¸å‡ºçš„åƒæ•¸ï¼ˆ$\lambda\in\mathbb{R}$ï¼‰ï¼Œè€Œloss functionä¾¿æ˜¯ç”¨self-adversarialçš„lossï¼Œå¸Œæœ›positive sampleçš„è·é›¢è¦å°æ–¼$\gamma$ï¼Œnegative sampleçš„è·é›¢è¦å¤§æ–¼$\gamma$</p>

\[L=-\log\sigma(\gamma-d_r(\mathbf{h},\mathbf{t}))-\sum\limits^{n}\limits_{i=1}p(h'_i,r,t'_i)\log\sigma(d_r(\mathbf{h}'_i,\mathbf{t}'_i)-\gamma)\]

\[p(h'_j,r,y'_j\vert\left\{(h_i,r_i,t_i)\right\})=\frac{\exp\alpha f_r(\mathbf{h}'_j,\mathbf{t}'_j)}{\sum_i\exp\alpha f_r(\mathbf{h}'_i,\mathbf{t}'_i)},\ where\ \alpha\ is\ temperature\]

\[f_r(\mathbf{h},\mathbf{t})=-d_r(\mathbf{h},\mathbf{t})=-d_{r,m}(\mathbf{h},\mathbf{t})-\lambda d_{r,p}(\mathbf{h},\mathbf{t})\]

<h2 id="experiments">Experiments</h2>

<p>ä½œè€…æŠŠé€™å€‹HAKEæ¨¡å‹ä½¿ç”¨åœ¨åº•ä¸‹ä¸‰å€‹datasetä¸Šï¼Œå®ƒå€‘çš„ä¸€äº›æ•¸æ“šæ”¾åœ¨åº•ä¸‹çš„è¡¨æ ¼ä¸­ã€‚</p>

<p><img src="./datasets.png" alt="Datasets" /></p>

<p><img src="./results.png" alt="Results" /></p>

<p>ä¸Šé¢æ˜¯èˆ‡å…¶ä»–æ¨¡å‹åœ¨é€™ä¸‰å€‹datasetä¸Šçš„æ¯”è¼ƒï¼Œå¯ä»¥çœ‹åˆ°HAKEçš„è¡¨ç¾ä¸ä¿—ã€‚</p>]]></content><author><name>Your Name</name></author><category term="Paper" /><category term="Graph-Model" /><summary type="html"><![CDATA[ç°¡å–®è¨˜éŒ„ä¸€ä¸‹çœ‹å®Œé€™ç¯‡paperçš„ç­†è¨˜ã€‚]]></summary></entry><entry><title type="html">Supersetä»‹ç´¹</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/02/superset-introduction/" rel="alternate" type="text/html" title="Supersetä»‹ç´¹" /><published>2022-05-02T00:00:00+00:00</published><updated>2022-05-02T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/02/superset-introduction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/05/02/superset-introduction/"><![CDATA[<p>é€™ç¯‡æ–‡ç« ç°¡å–®è¨˜éŒ„ä¸€ä¸‹å¦‚ä½•å®‰è£supersetä¸¦å¾Google Sheetså’ŒCSVç•¶ä¸­åŒ¯å…¥è³‡æ–™åšæˆdashboardã€‚</p>

<!--more-->

<h2 id="supersetç°¡ä»‹">Supersetç°¡ä»‹</h2>

<p>Supersetæ˜¯å€‹æœ€æ—©ç”±Airbnbé–‹ç™¼ï¼Œå¾Œä¾†é–‹æºåˆ°Apacheçš„businese intelligenceå·¥å…·ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥æ–¹ä¾¿åœ°è¦–è¦ºåŒ–è³‡æ–™åº«è£¡é¢çš„è³‡æ–™ï¼Œè€Œé€™é‚Šçš„è³‡æ–™åº«é™¤äº†å¸¸è¦‹çš„PostgreSQLã€Hiveä»¥å¤–ï¼Œé‚„æ”¯æ´å¾Google Sheetså’Œä½¿ç”¨è€…ä¸Šå‚³çš„CSVä¾†ç•¶ä½œè³‡æ–™çš„æºé ­ã€‚</p>

<h2 id="å®‰è£superset">å®‰è£Superset</h2>

<p>é€™é‚Šæ”¾ä¸Šæˆ‘å®‰è£æ™‚ä½¿ç”¨çš„æŒ‡ä»¤ï¼Œå…¶ä»–çš„å®‰è£æ–¹æ³•æˆ–è©³ç´°çš„ä»‹ç´¹å¯ä»¥åƒè€ƒ<a href="https://superset.apache.org/docs/installation/installing-superset-from-scratch">å®˜æ–¹çš„å®‰è£æ–‡ä»¶</a>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> gcc gcc-c++ libffi-devel python-devel python-pip python-wheel openssl-devel cyrus-sasl-devel openldap-devel bzip2-devel xz-devel
pip3 <span class="nb">install</span> <span class="nt">--upgrade</span> pip
pip3 <span class="nb">install </span>apache-superset <span class="nv">MarkupSafe</span><span class="o">==</span>2.0.1
<span class="c"># Recompile python if is shows python cannot import bz2</span>

<span class="nb">export </span><span class="nv">FLASK_APP</span><span class="o">=</span>superset
superset db upgrade

<span class="c"># Create default roles and permissions</span>
superset init

<span class="c"># Create an admin user in your metadata database (use `admin` as username to be able to load the examples)</span>
superset fab create-admin

<span class="c"># Load some data to play with</span>
superset load_examples

<span class="c"># To start a development web server on port 8088, use -p to bind to another port</span>
superset run <span class="nt">-p</span> 8088 <span class="nt">--with-threads</span> <span class="nt">--reload</span> <span class="nt">--debugger</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„æŒ‡ä»¤ä¸­ï¼Œæˆ‘å€‘æœ‰å»ºç«‹äº†ä¸€å€‹adminå¸³è™Ÿï¼Œå…¶å¸³è™Ÿå¯†ç¢¼éƒ½æ˜¯<code class="language-plaintext highlighter-rouge">admin</code>ï¼Œä¸¦åœ¨æœ€å¾Œä¸€è¡Œçš„æŒ‡ä»¤å•Ÿå‹•äº†supersetï¼Œé€™æ™‚ç†è«–ä¸Šé€£åˆ°<code class="language-plaintext highlighter-rouge">localhost:8088</code>å°±èƒ½çœ‹åˆ°supersetçš„UIäº†ã€‚</p>

<h2 id="è£½ä½œdashboardæµç¨‹">è£½ä½œDashboardæµç¨‹</h2>

<p>åœ¨supersetè£¡é¢è¦è£½ä½œæœ€å¾Œçš„dashboardå‰æœ‰å¹¾å€‹æ­¥é©Ÿéœ€è¦å…ˆåŸ·è¡Œï¼š</p>

<ol>
  <li>
    <p>å»ºç«‹Databaseï¼šèˆ‡databaseå»ºç«‹é€£ç·šï¼Œè®“supersetèƒ½å¾databaseè£¡é¢æ’ˆå–è³‡æ–™å‡ºä¾†ã€‚</p>
  </li>
  <li>
    <p>å»ºç«‹Datasetï¼šå¾databaseè£¡é¢å¼•å…¥tableï¼Œåœ¨databaseè£¡é¢å¯èƒ½æœ‰åƒåƒè¬è¬å€‹tableï¼Œé€™é‚Šæˆ‘å€‘éœ€è¦å‘Šè¨´supersetæˆ‘å€‘æœ‰èˆˆè¶£çš„tableæ˜¯å“ªäº›ï¼ŒåªæŠŠæœ‰èˆˆè¶£çš„table schemaå¼•å…¥åˆ°supersetè£¡é¢ã€‚</p>
  </li>
  <li>
    <p>è£½ä½œchartï¼šå¼•å…¥äº†tableä»¥å¾Œï¼Œå°±èƒ½å¯«SQLæˆ–æ˜¯ç”¨é å…ˆå®šç¾©å¥½çš„metricï¼ˆ$SUM(\star)$ã€$COUNT(\star)$ï¼‰ä¾†è¦–è¦ºåŒ–tableçš„è³‡è¨Šã€‚</p>
  </li>
  <li>
    <p>è£½ä½œdashboardï¼šæŠŠå‰ä¸€å€‹æ­¥é©Ÿè£½ä½œçš„chartçš„å‘ˆç¾åœ¨ä¸€å€‹dashboardä¸­ï¼Œæ–¹ä¾¿ä¸€æ¬¡ç€è¦½å¤šå€‹tableè¦–è¦ºåŒ–çš„çµæœã€‚</p>
  </li>
</ol>

<h2 id="å»ºç«‹database">å»ºç«‹Database</h2>

<p>åº•ä¸‹ä»‹ç´¹å¦‚ä½•ä½¿ç”¨é€£çµGoogle Sheetså’ŒPostgreSQLé€™å…©å€‹databaseï¼Œå¦‚æœæƒ³è¦é€£çµå…¶ä»–databaseçš„è©±ï¼Œå¯ä»¥åƒè€ƒ<a href="https://superset.apache.org/docs/databases/installing-database-drivers">å®˜æ–¹æ–‡ä»¶</a>ã€‚ç”±æ–¼supersetä¸»è¦æ˜¯ç”±pythonæ‰€ç·¨å¯«çš„ï¼Œç‚ºäº†è¦èƒ½è·Ÿdatabaseåšé€£ç·šï¼Œæˆ‘å€‘éœ€è¦å®‰è£ç›¸é—œdatabaseçš„python APIï¼Œåœ¨æ–‡ä»¶è£¡é¢æœ‰å»ºè­°è¦å®‰è£å“ªäº›å¥—ä»¶ã€‚</p>

<h3 id="google-sheets">Google Sheets</h3>

<h4 id="å®‰è£driver">å®‰è£driver</h4>

<p>å› ç‚ºåœ¨ å‰é¢æ˜¯é€é<code class="language-plaintext highlighter-rouge">pip3 install</code>ä¾†å®‰è£supersetçš„ï¼Œæ‰€ä»¥åœ¨é€™é‚Šä¹Ÿåªéœ€è¦ç°¡å–®çš„å®‰è£pip packageå°±èƒ½è®“supersetä½¿ç”¨äº†ï¼Œä¸éæœ‰å¯èƒ½æœƒéœ€è¦é‡æ–°å•Ÿå‹•supersetä¾†è®“å®ƒåƒåˆ°æœ€æ–°çš„APIã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install </span>shillelagh
</code></pre></div></div>

<h4 id="å¼•å…¥database">å¼•å…¥database</h4>

<p>åœ¨å®‰è£å¥½Google Sheets driverä»¥å¾Œï¼Œåœ¨supersetçš„UIä¸Šé¢é»é¸<code class="language-plaintext highlighter-rouge">Data&gt;Databases</code>ï¼Œåœ¨å³é‚Šå¯ä»¥çœ‹åˆ°æ–°å¢Databaseçš„æŒ‰éˆ•ï¼Œé»ä¸‹å»ä»¥å¾Œç†è«–ä¸Šå°±èƒ½çœ‹åˆ°<code class="language-plaintext highlighter-rouge">Google Sheets</code>çš„é¸é …äº†ã€‚</p>

<p><img src="./supported_databases_google_sheets.png" alt="Supported Databases - Google Sheets" /></p>

<p>åœ¨ä¸‹ä¸€å€‹ç•«é¢ç•¶ä¸­åªè¦å¡«ä¸Šç›¸å°æ‡‰çš„åç¨±å’Œç¶²å€å°±èƒ½é †åˆ©å»ºç«‹äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯Google Sheetsçš„æ¬Šé™å¿…é ˆè¦è¨­å®šæˆæ‰€æœ‰äººéƒ½èƒ½è§€çœ‹æ‰èƒ½å¼•å…¥ï¼Œå¦‚æœæƒ³è¦è®“ç§äººçš„Google Sheetsèƒ½è¢«supersetè®€å–çš„è©±ï¼Œå¯ä»¥åƒè€ƒ<a href="https://docs.preset.io/docs/google-sheets-private-connection">é€™ç¯‡æ–‡ç« </a>ï¼Œå¦å¤–Google Sheetsè£¡é¢æ¯ä¸€å€‹ä¸åŒçš„tabéƒ½éœ€è¦æ‰‹å‹•æ–°å¢é€²ä¾†ï¼Œå‡å¦‚èªªæˆ‘å€‘æƒ³è¦å¼•å…¥é€™å€‹sheetsè£¡é¢çš„<code class="language-plaintext highlighter-rouge">Simple sheet</code>ã€<code class="language-plaintext highlighter-rouge">2 header sheet</code>å’Œ<code class="language-plaintext highlighter-rouge">birth_names</code>çš„è©±ï¼Œå°±æœƒéœ€è¦å¡«å¯«ä»¥ä¸‹çš„è¨­å®šã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Name: simple sheet
URL: https://docs.google.com/spreadsheets/d/1_rN3lm0R_bU3NemO0s9pbFkY5LQPcuy1pscv8ZXPtg8/edit#gid<span class="o">=</span>0

Name: 2 header sheet
URL: https://docs.google.com/spreadsheets/d/1_rN3lm0R_bU3NemO0s9pbFkY5LQPcuy1pscv8ZXPtg8/edit#gid<span class="o">=</span>1077884006

Name: birth names
URL: https://docs.google.com/spreadsheets/d/1_rN3lm0R_bU3NemO0s9pbFkY5LQPcuy1pscv8ZXPtg8/edit#gid<span class="o">=</span>174770703
</code></pre></div></div>

<h3 id="postgresql">PostgreSQL</h3>

<h4 id="å®‰è£postgresql">å®‰è£PostgreSQL</h4>

<p>å®‰è£PostgreSQLçš„æ–¹å¼åœ¨ä¸åŒçš„OSä¸Šä¸å¤ªä¸€æ¨£ï¼Œé€™é‚Šè²¼ä¸Šæˆ‘å®‰è£æ™‚ä½¿ç”¨çš„æŒ‡ä»¤ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
<span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> postgresql14-server
<span class="nb">sudo</span> /usr/pgsql-14/bin/postgresql-14-setup initdb
<span class="nb">sudo </span>systemctl <span class="nb">enable </span>postgresql-14
<span class="nb">sudo </span>systemctl start postgresql-14
</code></pre></div></div>

<p>å®‰è£å¥½PostgreSQLä»¥å¾Œï¼Œæˆ‘å€‘éœ€è¦åœ¨å…¶ä¸­å»ºç«‹ä½¿ç”¨è€…å¸³è™Ÿï¼Œå¯ä»¥åƒè€ƒåº•ä¸‹çš„æŒ‡ä»¤ï¼Œè¨˜å¾—å°‡<code class="language-plaintext highlighter-rouge">USER_NAME</code>æ›¿æ›æˆè‡ªå·±çš„å¸³è™Ÿåç¨±ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-i</span> <span class="nt">-u</span> postgres
createuser USER_NAME
createdb USER_NAME
</code></pre></div></div>

<p>å¦‚æœé †åˆ©çš„è©±ï¼Œç†è«–ä¸Šåœ¨è‡ªå·±å¸³è™Ÿåº•ä¸‹åŸ·è¡Œ<code class="language-plaintext highlighter-rouge">psql</code>æ‡‰è©²å°±èƒ½é€²å…¥PostgreSQLçš„ä»‹é¢äº†ï¼Œé€™æ™‚æˆ‘å€‘éœ€è¦å¹«é€™å€‹å¸³è™Ÿè¨­å®šä¸€å€‹å¯†ç¢¼æ–¹ä¾¿supersetä¾†ç™»å…¥ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># In psql command line</span>
alter user USER_NAME password <span class="s1">'PASSWORD'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="å®‰è£driver-1">å®‰è£driver</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install </span>psycopg2-binary
</code></pre></div></div>

<h4 id="å¼•å…¥database-1">å¼•å…¥database</h4>

<p>å®‰è£å¥½driverä»¥å¾Œï¼Œåœ¨æŒ‰ä¸‹æ–°å¢databaseçš„æŒ‰éˆ•æ™‚ï¼Œæ‡‰è©²å°±èƒ½çœ‹åˆ°PostgreSQLçš„é¸é …äº†ï¼Œé€™é‚Šè²¼ä¸Šé è¨­çš„è¨­å®šï¼Œç†è«–ä¸ŠæŠŠ<code class="language-plaintext highlighter-rouge">USER_NAME</code>ã€<code class="language-plaintext highlighter-rouge">PASSWORD</code>æ›¿æ›æˆè‡ªè¡Œè¨­å®šçš„å€¼å¾ŒæŒ‰ä¸‹connectå°±å¯ä»¥äº†ã€‚</p>

<p><img class="image image--xl" src="./postgresql_database_settings.png" /></p>

<p>å¦‚æœå¸Œæœ›è®“supersetæ”¯æ´CSVä¸Šå‚³çš„åŠŸèƒ½ï¼Œéœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">ADVANCED</code>çš„è¨­å®šä¸­çš„<code class="language-plaintext highlighter-rouge">Security</code>è£¡é¢å‹¾é¸<code class="language-plaintext highlighter-rouge">Allow data upload</code>çš„é¸é …ï¼Œä¸Šå‚³çš„CSVæœƒåœ¨PostgreSQLè£¡é¢å»ºç«‹ä¸€å¼µæ–°çš„tableã€‚</p>

<h2 id="å»ºç«‹dataset">å»ºç«‹Dataset</h2>

<p>åœ¨æˆåŠŸå¼•å…¥databaseä»¥å¾Œï¼Œåœ¨<code class="language-plaintext highlighter-rouge">Data&gt;Datasets</code>è£¡é¢æŒ‰ä¸‹æ–°å¢Datasetçš„æŒ‰éˆ•ï¼Œé¸æ“‡å¥½databaseå°±èƒ½çœ‹åˆ°å‰é¢å¼•å…¥çš„databaseè£¡é¢çš„tableå€‘äº†ï¼Œé»é¸<code class="language-plaintext highlighter-rouge">ADD</code>ä»¥å¾Œå°±èƒ½åœ¨chartè£¡é¢è®€å–é€™äº›tableçš„è³‡æ–™ã€‚</p>

<p><img class="image image--xl" src="./add_dataset.png" /></p>

<h2 id="è£½ä½œchart">è£½ä½œChart</h2>

<p>æˆåŠŸå¼•å…¥datasetä»¥å¾Œï¼Œåœ¨create chartçš„éƒ¨åˆ†å°±èƒ½æ‰¾åˆ°å…ˆå‰å¼•å…¥çš„datasetäº†ï¼Œæ¥è‘—å°±èƒ½æ ¹æ“šæƒ³çœ‹çš„è³‡è¨Šä¾†åšå‡ºæ¼‚äº®çš„åœ–è¡¨ã€‚</p>

<p><img src="./create_new_chart.png" alt="Create New Chart" /></p>

<p><img src="./chart_settings.png" alt="Chart Settings" /></p>

<h2 id="è£½ä½œdashboard">è£½ä½œDashboard</h2>

<p>åœ¨æŠŠtableçš„è³‡è¨Šè¦–è¦ºåŒ–æˆchartä»¥å¾Œï¼Œå¦‚æœæƒ³è¦å°‡å¤šå€‹charté¡¯ç¤ºåœ¨åŒä¸€å€‹ç•«é¢å¯ä»¥ä½¿ç”¨dashboardï¼Œåœ¨å»ºç«‹dashboardçš„ç•«é¢è£¡é¢å¯ä»¥ç”¨æ‹–æ›³çš„æ–¹å¼ä¾†æŠŠæƒ³è¦é¡¯ç¤ºçš„chartæ”¾é€²ä¾†ã€‚</p>

<p><img src="./dashboard_settings.png" alt="Dashboard Settings" /></p>

<p>æœ€å¾ŒæŒ‰ä¸‹Saveå°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>

<p><img src="./dashboard_demo.png" alt="Dashboard Demo" /></p>]]></content><author><name>Your Name</name></author><category term="Tool" /><summary type="html"><![CDATA[é€™ç¯‡æ–‡ç« ç°¡å–®è¨˜éŒ„ä¸€ä¸‹å¦‚ä½•å®‰è£supersetä¸¦å¾Google Sheetså’ŒCSVç•¶ä¸­åŒ¯å…¥è³‡æ–™åšæˆdashboardã€‚]]></summary></entry><entry><title type="html">Airflowä»‹ç´¹</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/02/26/airflow-introduction/" rel="alternate" type="text/html" title="Airflowä»‹ç´¹" /><published>2022-02-26T00:00:00+00:00</published><updated>2022-02-26T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/02/26/airflow-introduction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2022/02/26/airflow-introduction/"><![CDATA[<p>é€™ç¯‡æ–‡ç« ç´€éŒ„ä¸€ä¸‹å˜—è©¦ä½¿ç”¨Airflowçš„ç¶“æ­·ã€‚</p>

<!--more-->

<p>ä¹‹å‰åœ¨è½ä¸€äº›æŠ€è¡“åˆ†äº«çš„æ™‚å€™ï¼Œæœ‰è½åˆ°åˆ¥äººä½¿ç”¨Airflowä¾†ä½œç‚ºä»–å€‘çš„æ’ç¨‹ç³»çµ±ï¼Œå‰›å¥½åœ¨ç¶²è·¯ä¸Šä¹Ÿæœ‰çœ‹åˆ°åˆ¥äºº<a href="https://leemeng.tw/a-story-about-airflow-and-data-engineering-using-how-to-use-python-to-catch-up-with-latest-comics-as-an-example.html">ä½¿ç”¨Airflowä¾†è¿½æ¼«ç•«é€£è¼‰</a>ï¼Œæƒ³èªªæˆ‘ä¹Ÿä¾†åšä¸€å€‹ç°¡å–®çš„æ¯å¤©ç™»å…¥é ˜çå‹µçš„ç¨‹å¼ä¾†å­¸ç¿’Airflowæ€éº¼ä½¿ç”¨ï¼Œåº•ä¸‹ç´€éŒ„ä¸€ä¸‹è£½ä½œçš„éç¨‹ã€‚</p>

<h2 id="å®‰è£airflow">å®‰è£Airflow</h2>

<p><a href="https://airflow.apache.org/">Airflow</a>æ˜¯ç”±Airbnbé–‹ç™¼çš„æ’ç¨‹ç³»çµ±ï¼Œä¸»è¦æ˜¯ç”±pythonç·¨å¯«ï¼Œå®‰è£èµ·ä¾†ä¹Ÿç›¸ç•¶åœ°æ–¹ä¾¿ï¼Œåªéœ€è¦åŸ·è¡Œåº•ä¸‹çš„æŒ‡ä»¤å°±è¡Œã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install</span> <span class="s2">"apache-airflow[crypto, slack]"</span>
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–database">åˆå§‹åŒ–database</h3>

<p>åœ¨å®‰è£å®Œæˆä»¥å¾Œï¼Œæœƒéœ€è¦å…ˆåˆå§‹åŒ–airflowçš„databaseï¼Œé€™å€‹databaseæœƒç”¨ä¾†å„²å­˜ä»»å‹™åŸ·è¡Œçš„è¨­å®šå’Œlogã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># export AIRFLOW_HOME=/path/you/want</span>
airflow db init
</code></pre></div></div>

<p>é è¨­çš„è·¯å¾‘æœƒæ”¾åœ¨<code class="language-plaintext highlighter-rouge">~/airflow</code>ï¼Œä½ ä¹Ÿå¯ä»¥è—‰ç”±<code class="language-plaintext highlighter-rouge">export AIRFLOW_HOME</code>ä¾†é¸æ“‡è‡ªå·±å–œæ­¡çš„ä½ç½®ã€‚</p>

<h3 id="é–‹å•Ÿweb-server">é–‹å•Ÿweb server</h3>

<p>æ¥ä¸‹ä¾†å°±å¯ä»¥æº–å‚™å•Ÿå‹•airflowäº†ï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨åº•ä¸‹çš„æŒ‡ä»¤é–‹å•Ÿweb serverï¼Œä¸¦è¨­å®športç‚º8080ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow webserver <span class="nt">-p</span> 8080
</code></pre></div></div>

<p>é€™æ™‚å°±å¯ä»¥é€£å»<code class="language-plaintext highlighter-rouge">localhost:8080</code>ä¾†çœ‹åˆ°airflowçš„ä½¿ç”¨è€…ä»‹é¢äº†ï¼Œä½†é€²å»çš„æ™‚å€™æœƒç™¼ç¾è¦å¸³è™Ÿå¯†ç¢¼æ‰èƒ½ç™»å…¥ï¼Œæˆ‘å€‘å¯ä»¥é€éä¸‹é¢çš„æŒ‡ä»¤ä¾†å‰µå»ºä¸€å€‹æ¬Šé™ç‚ºadminçš„å¸³æˆ¶ï¼Œå…¶å¸³è™Ÿå¯†ç¢¼éƒ½æ˜¯<code class="language-plaintext highlighter-rouge">admin</code>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow <span class="nb">users </span>create <span class="nt">--role</span> Admin <span class="nt">--username</span> admin <span class="nt">--email</span> admin <span class="nt">--firstname</span> admin <span class="nt">--lastname</span> admin <span class="nt">--password</span> admin
</code></pre></div></div>

<p>ç†è«–ä¸Šåœ¨é€™å€‹æ­¥é©Ÿåšå®Œä»¥å¾Œå°±èƒ½é †åˆ©åœ°çœ‹åˆ°é¡ä¼¼æ–¼åº•ä¸‹çš„ç•«é¢äº†ã€‚</p>

<p><img src="./airflow_ui.png" alt="Airflow UI" /></p>

<h3 id="é–‹å•Ÿscheduler">é–‹å•Ÿscheduler</h3>

<p>é›–èªªUIå·²ç¶“æ‰“å¾—é–‹äº†ï¼Œä½†æœƒç™¼ç¾ä¸Šé¢çš„ä»»å‹™éƒ½æ²’è¾¦æ³•åŸ·è¡Œï¼ŒåŸå› æ˜¯å› ç‚ºå¯¦éš›ä¸Šæ’ç¨‹é€™äº›ä»»å‹™çš„æ˜¯schedulerï¼Œè€Œweb serverå°±çœŸçš„åªæ˜¯ä¸€å€‹UIè®“ä½¿ç”¨è€…æ–¹ä¾¿ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘å€‘é‚„éœ€è¦åŸ·è¡Œåº•ä¸‹çš„æŒ‡ä»¤æ‰èƒ½å•Ÿå‹•ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>airflow scheduler
</code></pre></div></div>

<p>schedulerå’Œweb serverçš„é—œä¿‚å¯ä»¥åƒè€ƒ<a href="https://airflow.apache.org/docs/apache-airflow/stable/concepts/overview.html">airflowå®˜æ–¹æ–‡ä»¶</a>è£¡é¢çš„æ¶æ§‹åœ–ã€‚</p>

<p><img src="https://airflow.apache.org/docs/apache-airflow/stable/_images/arch-diag-basic.png" alt="Airflow Architecture" /></p>

<h2 id="å»ºç«‹å±¬æ–¼è‡ªå·±çš„ä»»å‹™">å»ºç«‹å±¬æ–¼è‡ªå·±çš„ä»»å‹™</h2>

<p>å‰é¢æœ‰æåˆ°airflowä¸»è¦æ˜¯ç”±pythonä¾†ç·¨å¯«çš„ï¼Œç•¶æˆ‘å€‘è¦åŠ å…¥ä¸€å€‹æ–°çš„ä»»å‹™æ™‚ï¼Œæˆ‘å€‘ä¹Ÿæ˜¯å¯«ä¸€å€‹pythonçš„scriptï¼Œä¸¦æ”¾å…¥<code class="language-plaintext highlighter-rouge">${AIRFLOW_HOME}/dags/</code>ï¼ˆé è¨­æ˜¯<code class="language-plaintext highlighter-rouge">~/airflow/dags/</code>ï¼‰é€™å€‹è·¯å¾‘åº•ä¸‹ï¼Œairflowå°±æœƒè‡ªå‹•æŠ“å–ä½ å¯«çš„scriptï¼Œåœ¨UIä¸Šé¢é¡¯ç¤ºå‡ºä¾†ã€‚</p>

<h3 id="airflow-python-script">Airflow Python Script</h3>

<p>ä¸€å€‹ç°¡å–®çš„ä»»å‹™å¯ä»¥åƒè€ƒåº•ä¸‹çš„ç¨‹å¼ç¢¼ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.operators.python_operator</span> <span class="kn">import</span> <span class="n">PythonOperator</span>
<span class="kn">from</span> <span class="nn">airflow.operators.dummy_operator</span> <span class="kn">import</span> <span class="n">DummyOperator</span>


<span class="k">def</span> <span class="nf">login_func</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Attempt to login with account = </span><span class="si">{</span><span class="n">account</span><span class="si">}</span><span class="s">, password = </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>


<span class="n">account</span> <span class="o">=</span> <span class="s">"user"</span>
<span class="n">password</span> <span class="o">=</span> <span class="s">"password"</span>
<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"owner"</span><span class="p">:</span> <span class="s">"THE_ONE"</span><span class="p">,</span>
    <span class="s">"start_date"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s">"schedule_interval"</span><span class="p">:</span> <span class="s">"@daily"</span><span class="p">,</span>
    <span class="s">"retries"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s">"retry_delay"</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">with</span> <span class="n">DAG</span><span class="p">(</span><span class="s">"login_dag"</span><span class="p">,</span> <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">)</span> <span class="k">as</span> <span class="n">dag</span><span class="p">:</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="s">"login"</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">login_func</span><span class="p">,</span>
        <span class="n">op_args</span><span class="o">=</span><span class="p">[</span><span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">],</span>
        <span class="n">provide_context</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="s">"do_nothing"</span><span class="p">)</span>

    <span class="n">login</span> <span class="o">&gt;&gt;</span> <span class="n">end</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„ç¨‹å¼ç¢¼è£¡é¢ï¼Œæˆ‘å€‘å…ˆå®šç¾©äº†ä¸€å€‹functionï¼Œå‡è£æ˜¯è¦ç™»å…¥æŸå€‹æœå‹™ï¼Œæ¥è‘—å®šç¾©äº†functionéœ€è¦ä½¿ç”¨åˆ°çš„åƒæ•¸<code class="language-plaintext highlighter-rouge">account</code>å’Œ<code class="language-plaintext highlighter-rouge">password</code>ï¼Œå†ä¾†æ˜¯é€™å€‹ä»»å‹™çš„åƒæ•¸ï¼Œæœ€å¾Œæ˜¯æ•´å€‹ä»»å‹™çš„æµç¨‹ã€‚</p>

<p><a href="https://airflow.apache.org/docs/apache-airflow/stable/concepts/operators.html">airflowæä¾›äº†è¨±è¨±å¤šå¤šçš„operator</a>ï¼Œå¯ä»¥æ ¹æ“šè‡ªå·±çš„éœ€è¦ä¾†å»é¸æ“‡å“ªä¸€å€‹operatoræ¯”è¼ƒé©åˆé€™å€‹ä»»å‹™ï¼Œåœ¨å®šç¾©å¥½äº†operatorçš„objectä»¥å¾Œï¼Œå†é€é<code class="language-plaintext highlighter-rouge">login &gt;&gt; end</code>é€™æ¨£çš„æ–¹å¼ä¾†å»æŠŠé€™äº›operatorä¸²åœ¨ä¸€èµ·ï¼Œé€™é‚Šä¹Ÿæ”¯æ´åˆ†æ”¯ï¼Œåªè¦æ•´å€‹æµç¨‹æ˜¯ä¸€å€‹Directed Acyclic Graphï¼ˆDAGï¼‰å°±è¡Œã€‚</p>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘åœ¨å¯«çš„æ™‚å€™å¦‚æœæŠŠ<code class="language-plaintext highlighter-rouge">with DAG(...):</code>é€™ä¸€æ®µæ”¾é€²<code class="language-plaintext highlighter-rouge">if __name__ == "__main__"</code>çš„è©±ï¼Œå¥½åƒairflowå°±æŠ“ä¸åˆ°çš„æ¨£å­ï¼Œåœ¨å¯«çš„æ™‚å€™éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p>

<h3 id="æ¸¬è©¦æ–°åŠ å…¥çš„ä»»å‹™">æ¸¬è©¦æ–°åŠ å…¥çš„ä»»å‹™</h3>

<p>åœ¨å¯«å¥½ä¸Šé¢çš„scriptä»¥å¾Œï¼Œå¯ä»¥ç›´æ¥åƒä»¥å¾€å¯«pythonçš„æ–¹å¼é‚£æ¨£å»åŸ·è¡Œçœ‹çœ‹ï¼Œå®ƒä¸¦ä¸æœƒçœŸçš„å»åŸ·è¡Œï¼Œairflowæœƒå»çœ‹æœ‰æ²’æœ‰å“ªé‚Šæœ‰èªæ³•ä¸Šçš„éŒ¯èª¤ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 /path/to/your/script.py
</code></pre></div></div>

<p>å¦‚æœæƒ³è¦å¯¦éš›æ¸¬è©¦çœ‹çœ‹ï¼Œå¯ä»¥ä¸Šå»UIã€é»é€²jobè£¡é¢ï¼Œå³ä¸Šè§’æœ‰å€‹ä¸‰è§’å½¢å¯ä»¥æ‰‹å‹•è·‘æ•´å€‹æµç¨‹è©¦è©¦çœ‹ã€‚</p>

<p><img src="./airflow_job.png" alt="Airflow Job Page" /></p>

<p>å¦‚æœè·‘èµ·ä¾†æœ‰ç¬¦åˆé æœŸçš„è©±ï¼Œå°±èƒ½toggleå·¦ä¸Šè§’çš„é¸é …ï¼Œå•Ÿå‹•é€™å€‹DAGï¼Œè®“å®ƒæ ¹æ“šè¨­å®šçš„é »ç‡ä¾†åŸ·è¡Œäº†ã€‚</p>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç•¶é–‹å•Ÿé€™å€‹DAGä»¥å¾Œï¼Œairflowæœƒè£œè·‘<code class="language-plaintext highlighter-rouge">start_date</code>åˆ°ä»Šå¤©çš„æ‰€æœ‰jobï¼Œæ‰€ä»¥è¦å…ˆç¢ºå®šä¸€ä¸‹<code class="language-plaintext highlighter-rouge">start_date</code>æœ‰æ²’æœ‰è¨­å®šå°å†é–‹å•Ÿæœƒæ¯”è¼ƒå¥½ã€‚</p>

<h3 id="é–‹å§‹çš„æ™‚é–“è·Ÿé æœŸçš„ä¸åŒ">é–‹å§‹çš„æ™‚é–“è·Ÿé æœŸçš„ä¸åŒï¼Ÿ</h3>

<p>åœ¨ä¸Šé¢çš„scriptè£¡é¢ï¼Œæˆ‘å€‘è¨­å®š</p>

<pre><code class="language-python3">    "start_date": datetime(2022, 2, 8, 11, 0),
    "schedule_interval": "@daily",
</code></pre>

<p>æœŸæœ›å®ƒå¯ä»¥å¾2022/2/8çš„æ—©ä¸Š11é»é–‹å§‹åŸ·è¡Œç¬¬ä¸€æ¬¡ï¼Œä¸¦ä»¥å¤©ç‚ºé »ç‡ä¾†åŸ·è¡Œï¼Œä½†å¯¦éš›ä¸Šæœƒç™¼ç¾å®ƒç¬¬ä¸€æ¬¡çš„åŸ·è¡Œæ™‚é–“æœƒæ˜¯2022/2/9çš„æ—©ä¸Š11é»ï¼ŒåŸå› æ˜¯å› ç‚ºä¸Šé¢å¯«çš„æ˜¯ä»»å‹™æ™‚é–“ï¼Œè·Ÿå¯¦éš›ä¸ŠåŸ·è¡Œçš„æ™‚é–“ä¸åŒï¼Œairflowæœƒåœ¨<code class="language-plaintext highlighter-rouge">start_date+schedule_interval</code>çš„æ™‚é–“éå®Œä»¥å¾Œæ‰é–‹å§‹è™•ç†<code class="language-plaintext highlighter-rouge">start_date+schedule_interval</code>çš„è³‡æ–™ã€‚</p>

<p>æƒ³æ³•ä¸Šæœ‰é»é¡ä¼¼æ–¼ï¼Œæˆ‘æƒ³å°‡ä»Šå¤©ä½¿ç”¨è€…çš„è³‡æ–™çµ±æ•´èµ·ä¾†ï¼Œä¸¦å£“ä¸Šä»Šå¤©çš„æ—¥æœŸï¼Œä½†æˆ‘å¯¦éš›åŸ·è¡Œçµ±æ•´é€™å€‹å‹•ä½œçš„æ™‚é–“æœƒæ˜¯åœ¨æ˜å¤©ï¼Œå› ç‚ºä»Šå¤©é‚„æ²’æœ‰éå®Œï¼Œå¦‚æœä»Šå¤©å°±åšçµ±æ•´ï¼Œå°±æœƒæœ‰éƒ¨åˆ†çš„è³‡æ–™è¢«æ¼æ‰ã€‚</p>

<h2 id="çµè«–">çµè«–</h2>

<p>Airflowæ˜¯å€‹å®‰è£ç°¡å–®ã€åŠŸèƒ½ä¹Ÿå¾ˆé½Šå…¨çš„æ’ç¨‹ç³»çµ±ï¼Œä¸Šé¢æ•˜è¿°çš„éƒ¨åˆ†åªæ˜¯airflowçš„ä¹ç‰›ä¸€æ¯›è€Œå·²ï¼Œé‚„æœ‰è¨±è¨±å¤šå¤šçš„åŠŸèƒ½æ²’æœ‰è¢«è¦†è“‹åˆ°ï¼Œå¦‚æœæœ‰èˆˆè¶£æˆ–æ˜¯æœ‰è¤‡é›œçš„åŠŸèƒ½æƒ³è¦å¯¦ç¾ï¼Œå¯ä»¥å»çœ‹çœ‹<a href="https://airflow.apache.org/docs/apache-airflow/stable/index.html">airflowçš„å®˜æ–¹æ–‡ä»¶</a>ã€‚</p>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ol>
  <li><a href="https://leemeng.tw/a-story-about-airflow-and-data-engineering-using-how-to-use-python-to-catch-up-with-latest-comics-as-an-example.html">ä¸€æ®µ Airflow èˆ‡è³‡æ–™å·¥ç¨‹çš„æ•…äº‹ï¼šè«‡å¦‚ä½•ç”¨ Python è¿½æ¼«ç•«é€£è¼‰</a></li>
</ol>]]></content><author><name>Your Name</name></author><category term="Tool" /><summary type="html"><![CDATA[é€™ç¯‡æ–‡ç« ç´€éŒ„ä¸€ä¸‹å˜—è©¦ä½¿ç”¨Airflowçš„ç¶“æ­·ã€‚]]></summary></entry><entry><title type="html">AutoKerasä»‹ç´¹</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/12/23/autokeras-introduction/" rel="alternate" type="text/html" title="AutoKerasä»‹ç´¹" /><published>2021-12-23T00:00:00+00:00</published><updated>2021-12-23T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/12/23/autokeras-introduction</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/12/23/autokeras-introduction/"><![CDATA[<p>ç¾åœ¨å¸‚é¢ä¸Šæœ‰çœ¾å¤šAutoMLçš„æ¡†æ¶ï¼Œè€Œç”¨æ·±åº¦å­¸ç¿’ä¸¦æœ‰Neural Architecture Searchï¼ˆNASï¼‰åŠŸèƒ½çš„ä¸¦ä¸å¤šï¼Œé€™é‚Šç´€éŒ„ä¸€ä¸‹ä½¿ç”¨AutoKerasçš„å¿ƒå¾—ã€‚</p>

<!--more-->

<h2 id="å®‰è£autokeras">å®‰è£AutoKeras</h2>

<p>å®‰è£çš„æ–¹å¼å¾ˆç°¡å–®ï¼Œåªéœ€è¦<code class="language-plaintext highlighter-rouge">pip install</code>å°±è¡Œäº†ï¼Œä¸éå€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æ–‡ç« æ’°å¯«çš„ç•¶ä¸‹ï¼Œé›–ç„¶<a href="https://autokeras.com/install/">AutoKerasçš„å®˜ç¶²</a>ä¸Šå¯«æ”¯æ´tensorflow 2.3.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä½†å¯¦éš›ç”¨tensorflow 2.7.0çš„æ™‚å€™æœƒå‡ºç¾å•é¡Œï¼Œå»ºè­°é‚„æ˜¯å…ˆä½¿ç”¨tensorflow 2.3.0ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install </span><span class="nv">tensorflow</span><span class="o">==</span>2.3.0 autokeras
</code></pre></div></div>

<h2 id="åˆ©ç”¨autokerasåštext-classification">åˆ©ç”¨AutoKerasåštext classification</h2>

<p>åœ¨<a href="https://autokeras.com/tutorial/overview/">AutoKerasçš„å®˜ç¶²</a>ä¸Šæœ‰å¾ˆå¤štutorialä¾†åšä¸åŒçš„ä»»å‹™ï¼Œåƒæ˜¯text classificationã€image classificationç­‰ç­‰ï¼Œé€™é‚Šå˜—è©¦çš„æ˜¯tutorialè£¡é¢çš„text classificationï¼Œä»»å‹™æ˜¯sentiment analysisï¼Œçµ¦å®šä¸€å€‹è©•è«–ï¼Œåˆ¤æ–·é€™å€‹è©•è«–æ˜¯æ­£é¢é‚„æ˜¯è² é¢çš„ã€‚</p>

<h3 id="æº–å‚™è¨“ç·´ç”¨çš„è³‡æ–™">æº–å‚™è¨“ç·´ç”¨çš„è³‡æ–™</h3>

<p>åº•ä¸‹çš„ç¨‹å¼ç¢¼æœƒå»å¾ç¶²è·¯ä¸ŠæŠ“å–datasetä¸‹ä¾†ï¼Œä¸¦åšæˆnumpyï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ–‡å­—çš„éƒ¨åˆ†æˆ‘å€‘ä¸¦æ²’æœ‰è½‰æˆindexï¼Œè€Œæ˜¯å–®ç´”çš„stringï¼Œè½‰æˆindexçš„éƒ¨åˆ†æœƒäº¤ç”±autokerasæ”¾åœ¨æ¨¡å‹è£¡é¢ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_files</span>


<span class="k">print</span><span class="p">(</span><span class="s">"Preparing data..."</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="n">fname</span><span class="o">=</span><span class="s">"aclImdb.tar.gz"</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s">"http://ai.stanford.edu/~amaas/data/sentiment/aclImdb_v1.tar.gz"</span><span class="p">,</span>
    <span class="n">extract</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># set path to dataset
</span><span class="n">IMDB_DATADIR</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="s">"aclImdb"</span><span class="p">)</span>

<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s">"pos"</span><span class="p">,</span> <span class="s">"neg"</span><span class="p">]</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">load_files</span><span class="p">(</span>
    <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMDB_DATADIR</span><span class="p">,</span> <span class="s">"train"</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">classes</span>
<span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">load_files</span><span class="p">(</span>
    <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">IMDB_DATADIR</span><span class="p">,</span> <span class="s">"test"</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">classes</span>
<span class="p">)</span>

<span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_data</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_data</span><span class="p">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_data</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_data</span><span class="p">.</span><span class="n">target</span><span class="p">)</span>

<span class="c1"># Minimize training size for tutorial
</span><span class="n">sample_size</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">x_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="p">[:</span><span class="n">sample_size</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">sample_size</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Data samples..."</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">x_train</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (sample_size,)
</span><span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (sample_size,)
</span><span class="k">print</span><span class="p">(</span><span class="n">x_train</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">50</span><span class="p">])</span>  <span class="c1"># b'Zero Day leads you to think, even re-think why two'
</span><span class="k">print</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">])</span>  <span class="c1"># [1 0 1 0 0 1 1 0 0 1 0 0 0 1 0 1 1 1 1 1 1 1 0 0 1 0 0 0 1 0]
</span></code></pre></div></div>

<h3 id="è¨“ç·´æ¨¡å‹">è¨“ç·´æ¨¡å‹</h3>

<p>åœ¨é€™é‚Šæˆ‘å€‘ä½¿ç”¨autokerasè£¡é¢çš„TextClassifierï¼Œè¨­å®š<code class="language-plaintext highlighter-rouge">max_trials</code>ç‚º2ï¼Œä»£è¡¨å˜—è©¦2ç¨®ä¸åŒçš„æ¨¡å‹æ¶æ§‹ï¼Œå¯ä»¥è¦–æƒ…æ³æŠŠé€™å€‹æ•¸å­—èª¿å¤§ï¼Œè€Œ<code class="language-plaintext highlighter-rouge">overwrite</code>æœƒå°‡ä¸Šæ¬¡è¨“ç·´çš„çµæœè¦†è“‹æ‰ï¼Œå¦‚æœæƒ³æ¥çºŒä¸Šæ¬¡è¨“ç·´ï¼Œå¯ä»¥æ”¹æˆ<code class="language-plaintext highlighter-rouge">False</code>ã€‚</p>

<p>åœ¨<code class="language-plaintext highlighter-rouge">fit()</code>è£¡é¢æœ‰è¨­å®š<code class="language-plaintext highlighter-rouge">epochs</code>ï¼Œè¡¨ç¤ºæ¯ä¸€å€‹æ¨¡å‹æ¶æ§‹æœƒè¨“ç·´å¤šå°‘å€‹epochã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">autokeras</span> <span class="k">as</span> <span class="n">ak</span>


<span class="k">print</span><span class="p">(</span><span class="s">"Building model..."</span><span class="p">)</span>
<span class="c1"># Initialize the text classifier.
</span><span class="n">clf</span> <span class="o">=</span> <span class="n">ak</span><span class="p">.</span><span class="n">TextClassifier</span><span class="p">(</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_trials</span><span class="o">=</span><span class="mi">2</span>
<span class="p">)</span>  <span class="c1"># It only tries 2 models as a quick demo.
</span><span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code class="language-plaintext highlighter-rouge">TextClassifier</code>å¯ä»¥è¨­å®šæ¨¡å‹çš„metricsè¦æ˜¯ä»€éº¼ï¼Œé è¨­æ˜¯<code class="language-plaintext highlighter-rouge">val_loss</code>ï¼Œå¯ä»¥ä¾æ“šä»»å‹™çš„éœ€æ±‚ä¾†åšä¿®æ”¹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cls</span> <span class="o">=</span> <span class="n">ak</span><span class="p">.</span><span class="n">TextClassifier</span><span class="p">(</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">max_trials</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">objective</span><span class="o">=</span><span class="s">"accuracy"</span><span class="p">,</span>  <span class="c1"># Change to other metric that is suitable for your task
</span><span class="p">)</span>
</code></pre></div></div>

<p>å¦å¤–ï¼Œ<code class="language-plaintext highlighter-rouge">TextClassifier</code>æœƒè‡ªå·±å»åˆ¤æ–·labelæœ‰å¤šå°‘å€‹ï¼Œä¸¦è‡ªå·±å°labelåšindexï¼Œåªæ˜¯åœ¨é æ¸¬çš„æ™‚å€™ä¸¦ä¸æœƒè‡ªå‹•æŠŠindexè½‰å›åŸæœ¬labelçš„æ¨£å­ï¼Œå»ºè­°é€™é‚Šè‡ªå·±å…ˆç”¨<code class="language-plaintext highlighter-rouge">sklearn.preprocessing.LabelEncoder</code>å…ˆå°labelåšindexï¼Œä¸¦åœ¨<code class="language-plaintext highlighter-rouge">fit()</code>çš„æ™‚å€™é¤µå…¥è½‰å¥½indexçš„è³‡æ–™ï¼Œä¹‹å¾Œåœ¨é æ¸¬æ™‚ï¼Œå°±å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">LabelEncoder</code>ä¾†è½‰å›labelåŸæœ¬çš„æ¨£å­ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pickle</span>


<span class="c1"># Before training
</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">labeler</span><span class="p">.</span><span class="n">transform</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
<span class="n">pickle</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="n">labeler</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">"/path/to/labeler.pkl"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">),</span> <span class="n">pickle</span><span class="p">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="c1"># After training
</span><span class="n">labeler</span> <span class="o">=</span> <span class="n">pickle</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"/path/to/labeler.pkl"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">labeler</span><span class="p">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="å„²å­˜æ¨¡å‹">å„²å­˜æ¨¡å‹</h3>

<p>é€™é‚Šæœƒå„²å­˜è¡¨ç¾æœ€å¥½çš„æ¨¡å‹ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">export_model</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"./model"</span><span class="p">,</span> <span class="n">save_format</span><span class="o">=</span><span class="s">"tf"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="n">model</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"./model.h5"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="æ¨¡å‹é æ¸¬">æ¨¡å‹é æ¸¬</h3>

<p>autokerasè¼¸å‡ºçš„æ¨¡å‹è·Ÿä¸€èˆ¬kerasè¨“ç·´å‡ºä¾†çš„æ¨¡å‹ç›¸åŒï¼Œæ‰€ä»¥æˆ‘å€‘å¯ä»¥ç”¨kerasçš„<code class="language-plaintext highlighter-rouge">load_model()</code>ä¾†è®€å–æ¨¡å‹ï¼Œä¸éæœƒéœ€è¦åœ¨å¾Œé¢åŠ ä¸Š<code class="language-plaintext highlighter-rouge">custom_objects</code>ï¼ŒæŠŠautokerasè‡ªå®šç¾©çš„objectå¸¶é€²ä¾†ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s">"./model"</span><span class="p">,</span> <span class="n">custom_objects</span><span class="o">=</span><span class="n">ak</span><span class="p">.</span><span class="n">CUSTOM_OBJECTS</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="çµè«–">çµè«–</h2>

<p>å¯ä»¥ç¨å¾®ç€è¦½ä¸€ä¸‹<a href="https://autokeras.com/tutorial/overview/">autokerasçš„tutorial</a>ï¼Œå¦‚æœç¢°åˆ°çš„ä»»å‹™ç¨®é¡æœ‰åœ¨è£¡é¢ï¼Œå¯ä»¥å˜—è©¦çœ‹çœ‹ï¼Œåªä¸éæœƒéœ€è¦è·‘åœ¨å¯ä»¥é€£ä¸Šå¤–ç¶²çš„æ©Ÿå™¨ä¸Šï¼Œå› ç‚ºautokerasæœƒå»ç¶²è·¯ä¸ŠæŠ“ä¸€äº›pretrainçš„æ¨¡å‹ä¸‹ä¾†ï¼Œå¦å¤–ä¹Ÿéœ€è¦æ³¨æ„ä¸€ä¸‹ç¡¬ç¢Ÿçš„ä½¿ç”¨é‡ï¼Œå› ç‚ºautokerasæœƒæŠŠæ¯å€‹trialè¨“ç·´çš„æ¨¡å‹å„²å­˜ä¸‹ä¾†ï¼Œå¾ˆå®¹æ˜“æŠŠç¡¬ç¢Ÿåƒæ»¿ï¼Œä¸ç„¶å°±æ˜¯éœ€è¦åœ¨<a href="https://autokeras.com/text_classifier/">ak.TextClassifier</a>è£¡é¢é™åˆ¶<code class="language-plaintext highlighter-rouge">max_model_size</code>çš„å¤§å°ã€‚</p>]]></content><author><name>Your Name</name></author><category term="Tool" /><summary type="html"><![CDATA[ç¾åœ¨å¸‚é¢ä¸Šæœ‰çœ¾å¤šAutoMLçš„æ¡†æ¶ï¼Œè€Œç”¨æ·±åº¦å­¸ç¿’ä¸¦æœ‰Neural Architecture Searchï¼ˆNASï¼‰åŠŸèƒ½çš„ä¸¦ä¸å¤šï¼Œé€™é‚Šç´€éŒ„ä¸€ä¸‹ä½¿ç”¨AutoKerasçš„å¿ƒå¾—ã€‚]]></summary></entry><entry><title type="html">Unsupervised Speech Recognition</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/08/28/unsupervised-speech-recognition/" rel="alternate" type="text/html" title="Unsupervised Speech Recognition" /><published>2021-08-28T00:00:00+00:00</published><updated>2021-08-28T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/08/28/unsupervised-speech-recognition</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/08/28/unsupervised-speech-recognition/"><![CDATA[<p>ç°¡å–®ä»‹ç´¹ä¸€ä¸‹Facebook AI Researchå‰é™£å­å‡ºçš„ã€ä»¥éç›£ç£çš„æ–¹å¼ä¾†åšèªéŸ³è¾¨è­˜çš„<a href="https://ai.facebook.com/research/publications/unsupervised-speech-recognition">paper</a>ã€‚</p>

<!--more-->

<h2 id="model-framework">Model Framework</h2>

<p>åœ¨é€™ç¯‡<a href="https://ai.facebook.com/blog/wav2vec-unsupervised-speech-recognition-without-supervision/">å®˜æ–¹çš„éƒ¨è½æ ¼æ–‡ç« </a>è£¡é¢æœ‰å°æ•´ç¯‡paperæœ‰å€‹å¤§è‡´çš„ä»‹ç´¹ï¼Œä¹Ÿæœ‰ä¸€æ®µå½±ç‰‡è¬›è§£é€™ç¯‡paperä½¿ç”¨çš„æ–¹æ³•ã€‚</p>

<p><img src="./wav2vec_u_framework.png" alt="wav2vec U Framework" /></p>

<p>ä¸Šåœ–æ˜¯é€™ç¯‡paper wav2vec Uçš„æ•´é«”æ¶æ§‹ï¼Œé¦–å…ˆæœƒå…ˆæŠŠæ•´æ®µèªéŸ³é€éwav2vec 2.0è½‰æ›æˆfeature sequenceï¼Œå†ä¾†å°é€™äº›featureåšk-meansï¼Œè—‰ç”±k-meansæ‰€ç²å¾—çš„clusterä¾†å°èªéŸ³è¨Šè™Ÿåšsegmentationï¼Œæœ€å¾Œå°‡segmentå¥½çš„èªéŸ³è¨Šè™Ÿçš„featureè¼¸å…¥è‡³generatorä¸­è½‰æ›æˆphoneme sequenceï¼Œæ­é…GANçš„æ–¹å¼ä¾†å»åšè¨“ç·´ã€‚</p>

<h2 id="wav2vec-20">wav2vec 2.0</h2>

<p><img src="./wav2vec_2_framework.png" alt="wav2vec 2.0 Framework" /></p>

<p>wav2vec 2.0çš„è¨“ç·´æ–¹å¼è·ŸBERTæœ‰äº›é¡ä¼¼ï¼Œé¦–å…ˆæœƒå…ˆå°‡èªéŸ³è¨Šè™Ÿé€éCNNæŠ½å–å‡ºé€™æ®µèªéŸ³çš„ç‰¹å¾µï¼Œæ¥è‘—å°å®ƒåšproduct quantizationï¼Œåœ¨æŠŠquantizationå‰çš„featureè¼¸å…¥é€²transformerä»¥å¾Œï¼Œå¸Œæœ›åœ¨è¢«maskæ‰çš„ä½ç½®æ‰€ç”¢ç”Ÿå‡ºä¾†çš„featureè¦è¶Šåƒquantizationå¾Œçš„featureè¶Šå¥½ï¼Œåœ¨è¨“ç·´çš„æ™‚å€™ä¹Ÿæœƒæ‹¿å…¶ä»–æ™‚é–“é»ç¶“équantizationå¾Œçš„featureä¾†åšcontrasive trainingã€‚</p>

<h3 id="product-quantization">Product Quantization</h3>

<p><img src="https://i.typlog.com/fabwrite/NM/ZL0fPpntjxi3pzrQirdw.png?x-oss-process=style/l" alt="Product Quantization" /></p>

<p><em><a href="http://www.fabwrite.com/productquantization">å®ä¾‹ç†è§£product quantizationç®—æ³•</a></em></p>

<p>å‡å¦‚èªªæˆ‘å€‘ç¾åœ¨æœ‰5è¬å¼µåœ–ç‰‡çš„featureï¼Œæ¯å€‹featureæœ‰1024ç¶­ï¼Œæˆ‘å€‘å°‡é€™1024ç¶­åˆ‡æˆ8ä»½ï¼Œæ¯ä»½æœ‰128ç¶­å¦‚ä¸Šåœ–é‚£æ¨£ï¼Œæ¥è‘—ä»¥ç¶­åº¦ç‚ºå–®ä½ä¾†åšk-meansï¼Œé€™é‚Šä»¤k=256ï¼Œæˆ‘å€‘å°±å¯ä»¥å°‡åŸå…ˆ1024ç¶­çš„featureè½‰æ›æˆç”±8å€‹cluster idæ‰€çµ„æˆçš„å‘é‡ï¼ŒæŠŠ1024ç¶­é™æˆäº†8ç¶­ã€‚</p>

<h2 id="segment-representations">Segment Representations</h2>

<p>ä¸€æ®µèªéŸ³è¼¸å…¥é€²wav2vec 2.0ä»¥å¾Œï¼Œæˆ‘å€‘å¯ä»¥å¾—åˆ°ä¸€ä¸²vector sequenceï¼Œè€Œä½œè€…å€‘æŠŠæ‰€æœ‰è¨“ç·´è³‡æ–™è£¡é¢çš„èªéŸ³éƒ½ä¸Ÿé€²å»wav2vec 2.0ï¼Œå°‡ç”¢ç”Ÿå‡ºä¾†çš„ä¸€å †å‘é‡æ‹¿å»åšk-meansï¼Œå¯ä»¥èªªæ˜¯å°æ¯ä¸€å°æ®µèªéŸ³è¨Šè™Ÿéƒ½çµ¦å®ƒä¸€å€‹ç·¨è™Ÿã€‚å¦‚æœæˆ‘å€‘ç™¼ç¾åˆ°èªªä¸€æ®µèªéŸ³è£¡é¢ç›¸é„°å…©å€‹featureçš„ç·¨è™Ÿç›¸åŒï¼Œå°±å¯ä»¥å°‡ä»–å€‘è¦–ç‚ºåœ¨åŒä¸€å€‹segmentè£¡é¢ï¼Œç›´åˆ°ç¢°åˆ°ä¸åŒç·¨è™Ÿã€‚</p>

<p>ä½œè€…å€‘å°‡åŒä¸€å€‹segmentè£¡é¢çš„featureåšå¹³å‡ä¾†ç•¶ä½œæ˜¯é€™å€‹segmentçš„representationï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œä½œè€…å€‘ä¸¦ä¸æ˜¯ç›´æ¥ä½¿ç”¨wav2vec 2.0ç”¢ç”Ÿå‡ºä¾†çš„featureåšå¹³å‡ï¼Œè€Œæ˜¯å…ˆå°æ‰€æœ‰è¨“ç·´è³‡æ–™ç¶“éwav2vec 2.0ç”¢ç”Ÿå‡ºçš„featureåšPCAï¼Œç”¨ç¶“éPCAè½‰æ›çš„featureå†ä¾†åšå¹³å‡ä»¥å¾Œç•¶ä½œsegmentçš„representationã€‚</p>

<h2 id="gan">GAN</h2>

<p><img src="./gan_framework.png" alt="GAN Framework" /></p>

<p>åœ¨å¾—åˆ°äº†segment representationä»¥å¾Œï¼Œæ¥ä¸‹ä¾†ä½œè€…å€‘å°‡é€™äº›representationè¼¸å…¥é€²generatorè£¡é¢ï¼Œå¸Œæœ›generatorç›´æ¥ç”¢ç”Ÿå‡ºphoneme distributionï¼Œé€™é‚Šå†æ­é…å¯¦éš›ä¸Šæ–‡å­—çš„æ‰€è½‰æ›å‡ºä¾†çš„phoneme 1-hot encodingï¼Œé€édiscriminatorä¾†è®“generatorç”¢ç”Ÿå‡ºçš„phoneme distributionèƒ½è¶ŠåƒçœŸå¯¦çš„phonemeè¶Šå¥½ã€‚å¦å¤–åœ¨é€™é‚Šä½œè€…å€‘æœ‰å°‡generatorç”¢ç”Ÿå‡ºä¾†ã€argmaxä»¥å¾Œæ˜¯ç›¸åŒçš„outputå†åšä¸€æ¬¡å¹³å‡ï¼Œä¹‹å¾Œæ‰è¼¸å…¥é€²discriminatorä¸­ã€‚</p>

<h2 id="experiment-results">Experiment Results</h2>

<p><img src="./librispeech_results.png" alt="Librispeech Results" /></p>

<p>åœ¨ç¶“éç¹è¤‡çš„è¨“ç·´æµç¨‹ä»¥å¾Œï¼Œå¯ä»¥çœ‹åˆ°wav2vec Uçš„è¡¨ç¾ä¸ä¿—ï¼Œæ­é…å²å®³çš„language modelä»¥å¾Œï¼Œerror rateå¯ä»¥åª²ç¾æ•¸å¹´å‰supervised learningçš„çµæœã€‚</p>

<p><img src="./low_resource_languages_results.png" alt="Low Resource Languages Results" /></p>

<p>åœ¨low-resourceä¸Šçš„è¡¨ç¾ç”šè‡³å¯ä»¥è´ésupervised learningçš„çµæœã€‚</p>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ol>
  <li><a href="http://www.fabwrite.com/productquantization">å®ä¾‹ç†è§£product quantizationç®—æ³•</a></li>
</ol>]]></content><author><name>Your Name</name></author><category term="Paper" /><category term="Speech-Recognition" /><summary type="html"><![CDATA[ç°¡å–®ä»‹ç´¹ä¸€ä¸‹Facebook AI Researchå‰é™£å­å‡ºçš„ã€ä»¥éç›£ç£çš„æ–¹å¼ä¾†åšèªéŸ³è¾¨è­˜çš„paperã€‚]]></summary></entry><entry><title type="html">Object Detectionæ¦‚è«–</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/object-detection/" rel="alternate" type="text/html" title="Object Detectionæ¦‚è«–" /><published>2021-07-25T00:00:00+00:00</published><updated>2021-07-25T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/object-detection</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/object-detection/"><![CDATA[<p>ç°¡å–®æ•´ç†ä¸€ä¸‹ç›®å‰æœ‰é—œobject detectionçš„ä¸€äº›ç ”ç©¶ã€‚</p>

<!--more-->

<h2 id="æš´åŠ›åšobject-detection">æš´åŠ›åšObject Detection</h2>

<p>éš¨è‘—æ·±åº¦å­¸ç¿’çš„èˆˆèµ·ï¼Œç¾åœ¨å·²ç¶“æœ‰å„å¼å„æ¨£çš„modelå¯ä»¥å¹«åŠ©æˆ‘å€‘åšimage classificationï¼Œè¾¨è­˜å‡ºåœ–ç‰‡è£¡é¢çš„æ˜¯ä»€éº¼æ±è¥¿ã€‚å¦‚æœæƒ³è¦ç›´æ¥ç”¨é€™äº›modelåšç‰©ä»¶åµæ¸¬ï¼Œä¸€å€‹ç°¡å–®æš´åŠ›çš„æ–¹å¼æ˜¯ï¼Œç”¨ä¸åŒå¤§å°çš„æ–¹æ¡†æƒéæ•´å¼µåœ–ç‰‡ï¼ŒæŠŠæ¯ä¸€å€‹æ–¹æ¡†çš„åœ–ç‰‡éƒ½ä¸Ÿé€²å»modelè£¡é¢åšç‰©ä»¶åˆ†é¡ä¾†é”åˆ°ç‰©ä»¶åµæ¸¬çš„æ•ˆæœã€‚</p>

<h2 id="region-with-cnnr-cnn">Region with CNNï¼ˆR-CNNï¼‰</h2>

<p>åœ¨å‰é¢æåˆ°æˆ‘å€‘å¯ä»¥ç”¨ä¸åŒçš„æ–¹æ¡†æƒéæ•´å¼µåœ–ç‰‡ä¾†åšç‰©ä»¶åµæ¸¬ï¼Œä½†é€™æ¨£çš„æ•ˆç‡æ˜é¡¯ä¸é«˜ï¼Œè€Œä¸”å¾ˆåƒè¨ˆç®—é‡ï¼Œé€™é‚Šè¦ä»‹ç´¹çš„<a href="https://arxiv.org/pdf/1311.2524.pdf">R-CNN</a>ä¾¿æ˜¯é€éSelective Searchä¾†é¸å–å¯èƒ½æœ‰æ±è¥¿çš„å€åŸŸï¼Œå†æ‹¿å»modelè£¡é¢åˆ†é¡ï¼Œå…¶å¤§è‡´ä¸Šçš„æµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>ç”¢ç”Ÿå¤§ç´„2000å€‹å¯èƒ½æœ‰æ±è¥¿çš„å€åŸŸï¼ˆRegion Proposalsï¼‰</li>
  <li>é€éé å…ˆè¨“ç·´å¥½çš„æ¨¡å‹åƒæ˜¯AlexNetã€Inceptionç­‰æŠ½å–åœ–ç‰‡ç‰¹å¾µ</li>
  <li>å°‡ç‰¹å¾µé€éSVMä¾†å»åˆ†è¾¨è£¡é¢æœ‰æ²’æœ‰å«æœ‰ç‰¹å®šç‰©é«”</li>
</ol>

<p><img src="./rcnn_architecture.png" alt="R-CNN Architecture" /></p>

<h3 id="selective-search">Selective Search</h3>

<p><a href="https://ivi.fnwi.uva.nl/isis/publications/2013/UijlingsIJCV2013/UijlingsIJCV2013.pdf">Selective search</a>æ˜¯ä»¥<a href="http://cs.brown.edu/people/pfelzens/papers/seg-ijcv.pdf">Graph Based Segmentation</a>çš„çµæœç‚ºåŸºç¤ï¼Œä½¿ç”¨éšå±¤ç¾¤èšæ¼”ç®—æ³•ä¾†å¾—åˆ°è¦è¼¸å…¥é€²modelçš„region proposalï¼ŒGraph Based Segmentationåœ¨Open CVè£¡é¢æœ‰æ”¯æ´ï¼Œä½¿ç”¨çš„æ–¹å¼å¯ä»¥åƒè€ƒ<a href="https://blog.gtwang.org/programming/opencv-graph-based-segmentation-tutorial/">é€™ç¯‡éƒ¨è½æ ¼</a>ã€‚</p>

<p>éšå±¤ç¾¤èšæ¼”ç®—æ³•æœƒå¾Graph Based Segmentationçš„çµæœè£¡é¢ï¼Œæ¯æ¬¡æŒ‘é¸å‡ºå…©å€‹æœ€ç›¸è¿‘çš„å€å¡Šåšåˆä½µï¼Œè€Œç›¸ä¼¼åº¦çš„è¨ˆç®—åŒ…å«äº†é¡è‰²ã€ç´‹ç†ã€å¤§å°ç­‰ç­‰çš„å› ç´ ï¼Œç¶œåˆèµ·ä¾†ä¾†åˆ¤æ–·å…©å€‹å€å¡Šçš„ç›¸ä¼¼åº¦ï¼Œè©³ç´°çš„ä»‹ç´¹å¯ä»¥åƒè€ƒ<a href="https://blog.gtwang.org/programming/selective-search-for-object-detection/">é€™ç¯‡éƒ¨è½æ ¼</a>ï¼Œå…·é«”æ¼”ç®—æ³•çš„æµç¨‹å¯ä»¥åƒè€ƒä¸‹åœ–ã€‚</p>

<p><img src="./selective_search_algorithm.png" alt="Selective Search Algorithm" /></p>

<h3 id="bounding-box-regression">Bounding-box Regression</h3>

<p>R-CNNé™¤äº†ä½¿ç”¨selective searchæ‰¾åˆ°æœ‰å¯èƒ½çš„region proposalä»¥å¤–ï¼Œæœ‰å¦å¤–é€ébounding-box regressionä¾†èª¿æ•´selective searchæ¡†å‡ºä¾†çš„bounding boxã€‚</p>

<p>å°æ–¼æ¯ä¸€å€‹bounding boxï¼Œæˆ‘å€‘å¯ä»¥é€é\((x, y, w, h)\)â€‹ä¾†è¡¨ç¤ºï¼Œé€™å››å€‹æ•¸å€¼åˆ†åˆ¥ä»£è¡¨é€™å€‹bounding boxä¸­å¿ƒé»åº§æ¨™å’Œé•·å¯¬ï¼Œè€Œbounding-box regressionæ˜¯æƒ³è¦é€éä¸€å€‹å¹³ç§»åŠ ç¸®æ”¾çš„mapping function \(f()\)â€‹ä¾†æŠŠselective searchå¾—åˆ°çš„bounding box \((P_x, P_y, P_w, P_y)\)é€éè½‰æ›ä»¥å¾Œå¯ä»¥è¶Šæ¥è¿‘labelå¥½çš„bounding box \((G_x, G_y, G_w, G_h)\)â€‹è¶Šå¥½ã€‚</p>

\[f(P_x, P_y, P_w, P_y)=(\hat{G}_x, \hat{G}_y, \hat{G}_w, \hat{G}_h)\approx(G_x, G_y, G_w, G_h)\]

<p>é€éå°‡\(f()\)â€‹å¼„æˆregression taskï¼Œä¹‹å¾Œä¾¿å¯ä»¥é€égradient descentä¾†è¨“ç·´\(f()\)â€‹ï¼Œæ›´è©³ç´°çš„èªªæ˜å¯ä»¥åƒè€ƒ<a href="https://blog.csdn.net/zijin0802034/article/details/77685438">é€™ç¯‡æ–‡ç« </a>ã€‚</p>

<h2 id="fast-r-cnn">Fast R-CNN</h2>

<p>åœ¨ä¸Šé¢çš„R-CNNè£¡é¢ï¼Œæ¯ä¸€å€‹region proposaléƒ½æœƒè¢«ä¸Ÿé€²é å…ˆè¨“ç·´å¥½çš„æ¨¡å‹ä¾†æŠ½å–åœ–ç‰‡ç‰¹å¾µï¼Œç„¶è€Œå¾ˆå¤šæ™‚å€™region proposalä¹‹é–“æœƒæœ‰é‡ç–Šçš„éƒ¨åˆ†ï¼Œå…¶å¯¦ä¸¦ä¸éœ€è¦é‡æ–°å†ç®—ä¸€éï¼Œå› æ­¤åœ¨<a href="https://arxiv.org/pdf/1504.08083.pdf">Fast R-CNN</a>è£¡é¢æƒ³è¦ç›´æ¥æŠŠregion proposalå°æ‡‰åˆ°feature mapä¸­ï¼Œä¾†é¿å…æ‰ä¸å¿…è¦çš„è¨ˆç®—ã€‚</p>

<p><img src="./fast_rcnn_architecture.png" alt="Fast R-CNN Architecture" /></p>

<p>Fast R-CNNè·ŸR-CNNä¸€æ¨£ï¼Œæœƒå…ˆéœ€è¦å…ˆé¸å¥½region proposalï¼Œåœ¨æŠŠåœ–ç‰‡ç¶“éCNNå¾—åˆ°feature mapçš„æ™‚å€™ï¼Œä¹Ÿæœƒå°‡é¸å¥½çš„region proposalä¹ŸæŠ•å½±åˆ°è·Ÿfeature mapä¸€æ¨£çš„å¤§å°ï¼Œç›´æ¥å°è©²å€å¡Šå…§çš„feature mapåšmax poolingå¾Œå¾—åˆ°å›ºå®šå¤§å°çš„featureï¼Œæœ€å¾Œé€éfully connected layersä¾†å¾—åˆ°regionè£¡é¢ç‰©é«”çš„é¡åˆ¥ï¼Œä»¥åŠå°bounding boxåšå›æ­¸ï¼Œé€™å€‹æ–¹æ³•è¢«ç¨±ä½œRegion of Interest Poolingï¼ˆRoI Poolingï¼‰ã€‚</p>

<p><img src="https://deepsense.ai/wp-content/uploads/2017/02/roi_pooling-1.gif" alt="RoI Pooling" /></p>

<p><em><a href="https://deepsense.ai/region-of-interest-pooling-explained/">Region of interest pooling explained</a></em></p>

<h2 id="faster-r-cnn">Faster R-CNN</h2>

<p>åœ¨Fast R-CNNè£¡é¢é‚„æ˜¯æœƒéœ€è¦è·‘selective searchä¾†å¾—åˆ°region proposalï¼Œè€Œ<a href="https://arxiv.org/pdf/1506.01497.pdf">Faster R-CNN</a>çš„æƒ³æ³•æ˜¯æƒ³è¦ç›´æ¥åœ¨CNNçš„feature mapè£¡é¢é€éRegion Proposal Networkä¾†ç›´æ¥å¾—åˆ°region proposalã€‚</p>

<p>Region Proposal Networkæ˜¯ä¸€å€‹CNNï¼Œå®ƒæœƒå…ˆç”¨å€‹sliding windowå»æƒéæ•´å¼µåœ–ç‰‡ï¼Œåœ¨æ¯å€‹windowçš„ä¸­å¿ƒé»å»å¥—ç”¨\(k\)â€‹â€‹å€‹é å…ˆå®šç¾©å¥½ã€ä¸åŒå¤§å°çš„anchor boxï¼Œå°‡anchor boxæ¡†å‡ºä¾†çš„feature mapè¼¸å…¥é€²CNNä»¥å¾Œï¼Œpredictå‡ºå«æœ‰ç‰©é«”çš„æ©Ÿç‡ï¼Œä»¥åŠå¯¦éš›bounding boxçš„åº§æ¨™ã€‚</p>

<p><img src="./region_proposal_network.png" alt="Region Proposal Network" /></p>

<p>å…¶æ•´é«”çš„æ¶æ§‹ç•«å‡ºä¾†å¤§æ¦‚é•·åº•ä¸‹é€™æ¨£ï¼Œä¸­é–“çš„å€å¡Šæ˜¯Faster R-CNNæå‡ºä¾†çš„RPNï¼Œè€Œå³é‚Šçš„æ˜¯åŸæœ¬Fast R-CNNæ—¢æœ‰çš„éƒ¨åˆ†ã€‚</p>

<p><img src="./faster_rcnn_graph.png" alt="Faster R-CNN Graph" /></p>

<p><em><a href="https://blog.csdn.net/jiongnima/article/details/79094159">å®ä¾‹åˆ†å‰²æ¨¡å‹Mask R-CNNè¯¦è§£ï¼šä»R-CNNï¼ŒFast R-CNNï¼ŒFaster R-CNNå†åˆ°Mask R-CNN</a></em></p>

<h2 id="mask-r-cnn">Mask R-CNN</h2>

<p><a href="https://arxiv.org/pdf/1703.06870.pdf">Mask R-CNN</a>åœ¨Faster R-CNNçš„åŸºç¤ä¸Šï¼Œä¿®æ”¹äº†RoI Poolingï¼Œèª¿æ•´æˆRoI Alignï¼Œä¸¦å¤šåŠ å…¥Mask predictionã€‚</p>

<p><img src="./mask_rcnn_graph.png" alt="Mask R-CNN Graph" /></p>

<p><em><a href="https://blog.csdn.net/jiongnima/article/details/79094159">å®ä¾‹åˆ†å‰²æ¨¡å‹Mask R-CNNè¯¦è§£ï¼šä»R-CNNï¼ŒFast R-CNNï¼ŒFaster R-CNNå†åˆ°Mask R-CNN</a></em></p>

<h3 id="roi-align">RoI Align</h3>

<p>åœ¨åŸæœ¬RoI Poolingçš„ä½¿ç”¨æƒ…å¢ƒä¸‹ï¼Œæœƒéœ€è¦åœ¨æŠŠregion proposalæŠ•å½±åˆ°feature mapçš„ç¶­åº¦æ™‚æŠŠåº§æ¨™å–æ•´æ•¸ï¼Œåœ¨è¨ˆç®—max poolingçš„æ™‚å€™ä¹Ÿéœ€è¦å°å€å¡Šçš„ç¯„åœå–æ•´æ•¸ï¼Œé›–ç„¶èªªåœ¨feature mapä¸Šé¢å–æ•´æ•¸å»é™¤æ‰çš„é›¶é ­çœ‹èµ·ä¾†ä¸å¤§ï¼Œä½†feature mapå¯¦éš›ä¸Šæ˜¯åœ–ç‰‡ç¶“éäº†å¾ˆå¤šCNNï¼Œæ¿ƒç¸®éçš„featureï¼Œå»é™¤æ‰çš„é›¶é ­åœ¨åŸæœ¬åœ–ç‰‡ä¸Šçš„å½±éŸ¿å…¶å¯¦æ˜¯æ¯”æƒ³åƒä¸­å¤§çš„ã€‚</p>

<p>å› æ­¤åœ¨Mask R-CNNè£¡é¢ä½¿ç”¨bilinear interpolationä¾†é¿å…æ‰å–æ•´æ•¸çš„å•é¡Œï¼Œä¸‹åœ–ä¸­çš„è—è‰²æ–¹æ¡†æ˜¯CNNè¼¸å‡ºçš„feature mapï¼Œè€Œé»‘è‰²æ–¹æ¡†æ˜¯RoIï¼Œè—‰ç”±interpolationçš„æ–¹å¼ä¾†è¨ˆç®—å‡ºè¦è¼¸å…¥è‡³å¾Œé¢çš„featureã€‚</p>

<p><img src="roi_align.png" alt="RoI Align" /></p>

<h3 id="mask-prediction">Mask Prediction</h3>

<p>åœ¨Mask R-CNNåšçš„å¦ä¸€ä»¶äº‹æƒ…æ˜¯å¼•å…¥<a href="https://www.cv-foundation.org/openaccess/content_cvpr_2015/papers/Long_Fully_Convolutional_Networks_2015_CVPR_paper.pdf">Fully Convolutional Networksï¼ˆFCNï¼‰</a>ä¾†åšpixel-wiseçš„maskï¼ŒFCNä¸»è¦æ˜¯å…ˆä½¿ç”¨CNNä¾†å°åœ–ç‰‡åšé™ç¶­ï¼Œä¹‹å¾Œå†é€édeconvolution CNNä¾†æŠŠfeatureé‚„åŸåˆ°åœ–ç‰‡åŸæœ¬çš„å¤§å°ï¼Œä¸¦predictå‡ºsegmentationã€‚</p>

<p><img src="./fcn_diagram.png" alt="FCN Diagram" /></p>

<h2 id="yolo">YOLO</h2>

<p>å‰é¢æ‰€æçš„R-CNNå€‘éƒ½æ˜¯region-basedçš„æ–¹æ³•ï¼Œæœƒéœ€è¦å…ˆæ±ºå®šæœ‰å¯èƒ½çš„region proposalå†å¾€å¾Œé€²è¡Œä¸‹å»ï¼Œè€Œ<a href="https://pjreddie.com/media/files/papers/yolo.pdf">YOLO</a>æ˜¯You Only Look Onceçš„ç¸®å¯«ï¼Œä¸€å€‹region-freeçš„æ–¹æ³•ï¼Œå¸Œæœ›å¯ä»¥åªè·‘ä¸€æ¬¡CNNå°±åŒæ™‚ç”¢ç”Ÿå‡ºbounding boxå’Œç‰©é«”çš„é¡åˆ¥ã€‚</p>

<p><img src="yolo_model.png" alt="YOLO Model" /></p>

<p>é¦–å…ˆï¼ŒYOLOæœƒå…ˆæŠŠåœ–ç‰‡åˆ‡æˆ\(S \times S\)â€‹å€‹gridï¼Œä¸¦è®“æ¯ä¸€å€‹gridéƒ½ç”¨neural networkå»é æ¸¬\(B\)â€‹å€‹å¯èƒ½çš„bounding boxã€å«æœ‰ç‰©ä»¶çš„ä¿¡å¿ƒç¨‹åº¦ä»¥åŠç‰©ä»¶çš„é¡åˆ¥ã€‚åœ¨åœ–ä¸­ä¸ŠåŠéƒ¨ä¸åŒçš„é»‘æ¡†ä¾¿æ˜¯é æ¸¬å‡ºä¾†çš„bounding boxï¼Œè€Œä¸åŒçš„ç²—ç´°è¡¨ç¤ºä¿¡å¿ƒç¨‹åº¦çš„å¤§å°ï¼Œè€Œä¸‹åŠéƒ¨æ˜¯ç‰©ä»¶é¡åˆ¥çš„é æ¸¬çµæœã€‚</p>

<p>åœ¨é¸å‡ºäº†æœ‰å¯èƒ½çš„bounding boxå’Œé¡åˆ¥åµæ¸¬çš„çµæœä»¥å¾Œï¼Œæœƒå…ˆç”¨ä¸€å€‹å›ºå®šçš„thresholdæŠŠä¿¡å¿ƒç¨‹åº¦å¤ªä½çš„bounding boxå»é™¤æ‰ï¼Œç„¶å¾Œä½¿ç”¨Non-Maximum Supressionï¼ˆNMSï¼‰ä¾†è¨ˆç®—å‡ºæœ€å¾Œçš„è¼¸å‡ºçµæœï¼ŒNMSé‹ä½œçš„æ–¹å¼å¯ä»¥åƒè€ƒ<a href="https://chih-sheng-huang821.medium.com/%E6%A9%9F%E5%99%A8-%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92-%E7%89%A9%E4%BB%B6%E5%81%B5%E6%B8%AC-non-maximum-suppression-nms-aa70c45adffa">é€™ç¯‡æ–‡ç« </a>ï¼Œè£¡é ­æœ‰è©³ç´°çš„åœ–è§£å¯ä»¥åƒè€ƒã€‚</p>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ol>
  <li><a href="https://blog.gtwang.org/programming/opencv-graph-based-segmentation-tutorial/">OpenCV æ•™å­¸ï¼šå¯¦ä½œ Graph Based Segmentation åœ–å½¢åˆ†å‰²æ¼”ç®—æ³•</a></li>
  <li><a href="https://blog.gtwang.org/programming/selective-search-for-object-detection/">OpenCV æ•™å­¸ï¼šå¯¦ä½œ Selective Search ç‰©é«”åµæ¸¬å€™é¸å€åŸŸæ¼”ç®—æ³•</a></li>
  <li><a href="https://blog.csdn.net/zijin0802034/article/details/77685438">è¾¹æ¡†å›å½’(Bounding Box Regression)è¯¦è§£</a></li>
  <li><a href="https://ccshenyltw.medium.com/object-detection-r-cnn-fast-rcnn-faster-rcnn-mask-rcnn-retinanet-to-be-continued-71b67640445">Object Detection : R-CNN, Fast-RCNN, Faster RCNN</a></li>
  <li><a href="https://medium.com/cubo-ai/%E7%89%A9%E9%AB%94%E5%81%B5%E6%B8%AC-object-detection-740096ec4540">é—œæ–¼å½±åƒè¾¨è­˜ï¼Œæ‰€æœ‰ä½ æ‡‰è©²çŸ¥é“çš„æ·±åº¦å­¸ç¿’æ¨¡å‹</a></li>
  <li><a href="https://blog.csdn.net/jiongnima/article/details/79094159">å®ä¾‹åˆ†å‰²æ¨¡å‹Mask R-CNNè¯¦è§£ï¼šä»R-CNNï¼ŒFast R-CNNï¼ŒFaster R-CNNå†åˆ°Mask R-CNN</a></li>
  <li><a href="https://deepsense.ai/region-of-interest-pooling-explained/">Region of interest pooling explained</a></li>
  <li><a href="https://chih-sheng-huang821.medium.com/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92-%E7%89%A9%E4%BB%B6%E5%81%B5%E6%B8%AC-you-only-look-once-yolo-4fb9cf49453c">æ·±åº¦å­¸ç¿’-ç‰©ä»¶åµæ¸¬:You Only Look Once (YOLO)</a></li>
  <li><a href="https://chih-sheng-huang821.medium.com/%E6%A9%9F%E5%99%A8-%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92-%E7%89%A9%E4%BB%B6%E5%81%B5%E6%B8%AC-non-maximum-suppression-nms-aa70c45adffa">æ©Ÿå™¨/æ·±åº¦å­¸ç¿’: ç‰©ä»¶åµæ¸¬ Non-Maximum Suppression (NMS)</a></li>
</ol>]]></content><author><name>Your Name</name></author><category term="Computer-Vision" /><category term="Object-Detection" /><summary type="html"><![CDATA[ç°¡å–®æ•´ç†ä¸€ä¸‹ç›®å‰æœ‰é—œobject detectionçš„ä¸€äº›ç ”ç©¶ã€‚]]></summary></entry><entry><title type="html">åœ¨é ç«¯çš„jobåŸ·è¡Œå®Œæˆæ™‚ç™¼é€é€šçŸ¥</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/remote-job-finish-notification/" rel="alternate" type="text/html" title="åœ¨é ç«¯çš„jobåŸ·è¡Œå®Œæˆæ™‚ç™¼é€é€šçŸ¥" /><published>2021-07-25T00:00:00+00:00</published><updated>2021-07-25T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/remote-job-finish-notification</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/25/remote-job-finish-notification/"><![CDATA[<p>é€™é‚Šè¨˜éŒ„ä¸€å€‹æ–¹æ³•ä¾†ç•¶serverä¸Šçš„jobè·‘å®Œæ™‚ï¼Œå¯ä»¥åœ¨MacBookä¸Šé¢è·³å‡ºä¸€å€‹é€šçŸ¥ã€‚</p>

<!--more-->

<h2 id="æ–¹æ³•ç°¡ä»‹">æ–¹æ³•ç°¡ä»‹</h2>

<p>ä½¿ç”¨çš„æ–¹æ³•æ˜¯é€éåœ¨SSHé€£ç·šè‡³é ç«¯serverçš„æ™‚å€™ï¼Œé †ä¾¿åšport forwardingï¼ŒæŠŠè‡ªå·±é›»è…¦çš„port 22æ¥ä¸Šé ç«¯serverï¼Œå¦‚æ­¤ä¾¿å¯ä»¥è®“é ç«¯serveré€éSSHé€£ç·šå›é›»è…¦ä¸Šä½¿ç”¨command lineè·³å‡ºé€šçŸ¥ã€‚</p>

<h2 id="åœ¨macbookä¸Šé¢å…è¨±sshé€£ç·š">åœ¨MacBookä¸Šé¢å…è¨±SSHé€£ç·š</h2>

<p>é¦–å…ˆï¼Œæˆ‘å€‘å¿…é ˆè¦è®“MacBookå¯ä»¥æ¥å—SSHé›¢ç·šï¼Œåªéœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">è¨­å®šâ†’å…±äº«</code>è£¡é¢æ‰“é–‹SSHé€£ç·šçš„è¨­å®šå°±å¯ä»¥äº†ï¼Œåœ¨<a href="https://support.apple.com/zh-tw/guide/mac-help/mchlp1066/mac">Appleå®˜æ–¹çš„ä½¿ç”¨æ‰‹å†Š</a>ä¸Šæœ‰è©³ç´°çš„èªªæ˜ã€‚</p>

<h2 id="forward-local-port">Forward Local Port</h2>

<p>åœ¨SSHé€£ç·šåˆ°é ç«¯serverçš„æ™‚å€™ï¼Œå¯ä»¥å¤šåŠ <code class="language-plaintext highlighter-rouge">-R</code>é€™å€‹optionï¼Œä¾¿å¯ä»¥æŠŠæœ¬æ©Ÿçš„portæ¥åˆ°é ç«¯serverä¸Šã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-R</span> 2000:localhost:22 &lt;username&gt;@&lt;<span class="nb">hostname</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>åœ¨ä¸Šé¢çš„æŒ‡ä»¤ç•¶ä¸­ï¼Œä¾¿æ˜¯å°‡é ç«¯serverçš„port 2000è·Ÿæœ¬æ©Ÿçš„port 22åšé€£çµã€‚</p>

<h2 id="å¾serveré€£å›æœ¬æ©Ÿ">å¾Serveré€£å›æœ¬æ©Ÿ</h2>

<p>åœ¨é€£ä¸Šserverä»¥å¾Œï¼Œå¯ä»¥å…ˆè©¦è‘—å°‡åº•ä¸‹çš„<code class="language-plaintext highlighter-rouge">username</code>æ›æˆæœ¬æ©Ÿçš„ä½¿ç”¨è€…åç¨±æ¸¬è©¦çœ‹çœ‹èƒ½ä¸èƒ½é€£å›ä¾†ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-p</span> 2000 &lt;username&gt;@localhost
</code></pre></div></div>

<p>å¦‚æœèƒ½é †åˆ©é€£å›ä¾†çš„è©±ï¼Œæ¥ä¸‹ä¾†ä¾¿æ˜¯æŠŠpublic keyæ”¾åˆ°æœ¬æ©Ÿè£¡é¢ï¼Œä»¥é¿å…æ¯æ¬¡é€£ç·šéƒ½è¦æ‰“å¯†ç¢¼ï¼Œè©³ç´°çš„æµç¨‹çœ‹åº•ä¸‹çš„æ­¥é©Ÿï¼Œä¸»è¦æ˜¯åƒè€ƒ<a href="https://help.dreamhost.com/hc/en-us/articles/216499537-How-to-configure-passwordless-login-in-Mac-OS-X-and-Linux">é€™ç¯‡æ–‡ç« </a>ã€‚</p>

<ol>
  <li>
    <p>åœ¨serverä¸Šä½¿ç”¨åº•ä¸‹çš„æŒ‡ä»¤å‰µé€ key</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh-keygen
</code></pre></div>    </div>
  </li>
  <li>
    <p>æŠŠå‰µå»ºå‡ºä¾†ï¼Œå¸¶æœ‰<code class="language-plaintext highlighter-rouge">.pub</code>å‰¯æª”åçš„æª”æ¡ˆè£¡é¢æ‰€æœ‰çš„å…§å®¹è¤‡è£½é€²æœ¬æ©Ÿçš„<strong>~/.ssh/authorized_keys</strong>é€™ä»½æª”æ¡ˆä¸­ï¼Œå¦‚æœé€™å€‹æª”æ¡ˆåŸæœ¬ä¸å­˜åœ¨ï¼Œå¯ä»¥ç›´æ¥ç”¨æ–‡å­—ç·¨è¼¯å™¨å»ºç«‹</p>
  </li>
  <li>
    <p>åœ¨serverä¸Šé€ékeyä¾†é€£ç·šè‡³æœ¬æ©Ÿ</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ssh <span class="nt">-i</span> &lt;path to private key&gt; <span class="nt">-p</span> &lt;port&gt; &lt;username&gt;@localhost
</code></pre></div>    </div>

    <p>é è¨­private keyçš„è·¯å¾‘æœƒæ˜¯<strong>~/.ssh/id_rsa</strong>ã€‚</p>
  </li>
</ol>

<h2 id="å‚³é€notification">å‚³é€Notification</h2>

<p>åœ¨èƒ½é †åˆ©å¾serveré€£å›æœ¬æ©Ÿä»¥å¾Œï¼Œå°±å¯ä»¥é€écommand lineä¾†å‚³é€notificationäº†ï¼Œåº•ä¸‹çš„æŒ‡ä»¤æ˜¯ä½¿ç”¨MacBookåŸç”Ÿçš„æŒ‡ä»¤ä¾†ç”¢ç”Ÿnotificationï¼Œå…¶ä»–argumentå¯ä»¥åƒè€ƒ<a href="https://code-maven.com/display-notification-from-the-mac-command-line">é€™ç¯‡æ–‡ç« </a>ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>osascript <span class="nt">-e</span> <span class="s1">'display notification "" with title "Job Finished!" subtitle ""'</span>
</code></pre></div></div>

<p>åœ¨é€šçŸ¥è·³å‡ºä¾†ä»¥å¾Œï¼Œå¯ä»¥å°è‘—é€šçŸ¥æŒ‰å³éµå°é€šçŸ¥åšè¨­å®šã€‚</p>

<h2 id="ç¸½çµ">ç¸½çµ</h2>

<p>ä¸Šé¢ä½¿ç”¨äº†ä¸€å€‹ç°¡å–®çš„æ–¹å¼ä¾†è®“serveræ§åˆ¶æœ¬æ©Ÿç™¼é€é€šçŸ¥ï¼Œå¯ä»¥å°‡é€£ç·šã€ç™¼é€é€šçŸ¥å¯«æˆè…³æœ¬ï¼Œä¸¦åœ¨serverå®Œæˆjobæ™‚å‘¼å«é€™å€‹è…³æœ¬ä¾†æé†’ä½ jobå·²ç¶“è·‘å®Œäº†ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>Your <span class="nb">command</span><span class="o">]</span> <span class="o">||</span> send_notification.sh
</code></pre></div></div>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ol>
  <li><a href="https://serverfault.com/questions/175798/ssh-back-to-the-local-machine-from-a-remote-ssh-session">SSH back to the local machine from a remote SSH session</a></li>
</ol>]]></content><author><name>Your Name</name></author><category term="Tool" /><summary type="html"><![CDATA[é€™é‚Šè¨˜éŒ„ä¸€å€‹æ–¹æ³•ä¾†ç•¶serverä¸Šçš„jobè·‘å®Œæ™‚ï¼Œå¯ä»¥åœ¨MacBookä¸Šé¢è·³å‡ºä¸€å€‹é€šçŸ¥ã€‚]]></summary></entry><entry><title type="html">æ·±åº¦å­¸ç¿’æ–¼èªéŸ³è¾¨è­˜</title><link href="https://wjohn1483.github.io/#%20the%20base%20hostname%20&%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/18/speech-recognition-with-deep-learning/" rel="alternate" type="text/html" title="æ·±åº¦å­¸ç¿’æ–¼èªéŸ³è¾¨è­˜" /><published>2021-07-18T00:00:00+00:00</published><updated>2021-07-18T00:00:00+00:00</updated><id>https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/18/speech-recognition-with-deep-learning</id><content type="html" xml:base="https://wjohn1483.github.io/#%20the%20base%20hostname%20&amp;%20protocol%20for%20your%20site%20e.g.%20https://www.someone.com/2021/07/18/speech-recognition-with-deep-learning/"><![CDATA[<p>åœ¨<a href="https://wjohn1483.github.io/2021/06/14/introduction-to-speech-recognition/">å…ˆå‰çš„æ–‡ç« </a>è£¡é ­ï¼Œä»‹ç´¹äº†åœ¨æ·±åº¦å­¸ç¿’è“¬å‹ƒç™¼å±•ä¹‹å‰ï¼ŒèªéŸ³è¾¨è­˜å¤§æ¦‚æ˜¯å¦‚ä½•é”æˆçš„ï¼Œè€Œé€™ç¯‡æ–‡ç« æœƒç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼Œåœ¨åŠ å…¥äº†æ·±åº¦å­¸ç¿’ä»¥å¾Œï¼ŒèªéŸ³è¾¨è­˜çš„æŠ€è¡“æœ‰äº†ä»€éº¼æ¨£çš„æ›´å‹•ã€‚</p>

<!--more-->

<p>éå»åœ¨åšèªéŸ³è¾¨è­˜çš„æ™‚å€™ï¼Œæœƒéœ€è¦ä¸åŒçš„æ¨¡å‹äº’ç›¸å”ä½œï¼Œè€Œéš¨è‘—æ·±åº¦å­¸ç¿’çš„ç™¼å±•ï¼Œæœ‰äº›èªéŸ³è¾¨è­˜çš„æ–¹æ³•å·²ç¶“å¯ä»¥å°‡æ‰€æœ‰çš„æ¨¡å‹æ•´åˆæˆä¸€å€‹æ¨¡å‹ï¼Œå¤§å¤§ç°¡åŒ–äº†èªéŸ³è¾¨è­˜çš„è¤‡é›œåº¦ã€‚</p>

<h2 id="listen-attend-and-spelllas">Listen, Attend and Spellï¼ˆLASï¼‰</h2>

<p>ç¬¬ä¸€å€‹è¦æåˆ°çš„æ¨¡å‹æ˜¯LASï¼Œæ˜¯ä¸€å€‹End-to-endçš„èªéŸ³è¾¨è­˜æ¨¡å‹ï¼Œè¼¸å…¥èªéŸ³è¨Šè™Ÿï¼Œè¼¸å‡ºå°±æ˜¯characterã€‚</p>

<p><img src="./LAS_model_architecture.png" alt="LAS Model Architecture" /></p>

<p>ä¸Šåœ–ç‚ºLASæ¨¡å‹çš„æ¶æ§‹ï¼Œå…¶å¯¦å°±æ˜¯ä¸€å€‹sequence to sequenceçš„modelæ­é…attentionï¼Œä¸éæ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯ï¼Œåœ¨encoderä¹Ÿå°±æ˜¯ä¸Šåœ–ä¸­çš„Listenerè£¡é ­ï¼Œä½¿ç”¨çš„æ˜¯pyramidal bidirectional LSTMï¼Œå› ç‚ºè¼¸å…¥çš„èªéŸ³è¨Šè™Ÿçš„å€‹æ•¸é€šå¸¸éƒ½é å¤§æ–¼è¼¸å‡ºçš„å­—æ•¸ï¼Œæ‰€ä»¥é€épyramidalçš„æ–¹å¼ä¾†æ¸›å°‘decoder attendçš„æ•¸é‡ï¼›å¦ä¸€å€‹ç‰¹åˆ¥çš„åœ°æ–¹æ˜¯ï¼Œåœ¨decoderçš„ä¹Ÿå°±æ˜¯ä¸Šåœ–ä¸­çš„Spellerè£¡é¢ï¼Œä»ç„¶æœƒå°‡RNNçš„è¼¸å‡ºæ‹‰å›ä¾†æ”¾é€²ä¸‹ä¸€å€‹æ™‚é–“é»çš„è¼¸å…¥ã€‚</p>

<p>LASçš„modelé›–ç„¶å¯ä»¥å¹«åŠ©æˆ‘å€‘åšèªéŸ³è¾¨è­˜ï¼Œä½†é€™å€‹æ¨¡å‹éœ€è¦å°‡æ•´å€‹å¥å­éƒ½è½å®Œæ‰å¯ä»¥é–‹å§‹è¾¨è­˜ï¼Œå¦‚æœè¼¸å…¥é€²ä¾†çš„èªéŸ³è¨Šè™Ÿå¾ˆé•·ï¼Œæˆ–æ˜¯æƒ³è¦å°ä¸²æµèªéŸ³åšèªéŸ³è¾¨è­˜ï¼Œå°±å¾—è¦ä½¿ç”¨å…¶ä»–çš„æ–¹å¼ï¼Œå¯ä»¥åƒè€ƒåº•ä¸‹çš„æ–¹æ³•ã€‚</p>

<h2 id="connectionist-temporal-classificationctc">Connectionist Temporal Classificationï¼ˆCTCï¼‰</h2>

<p>CTCæ˜¯ä¸€ç¨®åŸºæ–¼RNN loss functionçš„æ–¹æ³•ï¼Œå¯ä»¥æŠŠæ¯”è¼ƒé•·çš„è¼¸å…¥\(X\)è½‰æ›æˆæ¯”è¼ƒçŸ­çš„è¼¸å‡º\(Z\)ï¼Œè·ŸèªéŸ³è¾¨è­˜æ‰€éœ€è¦çš„æ¢ä»¶ç›¸åŒï¼Œè€ŒCTCçš„ç‰¹é»åœ¨æ–¼è¼¸å‡ºçš„æ™‚å€™æœƒå¤šä¸€å€‹<code class="language-plaintext highlighter-rouge">blank</code>çš„ç¬¦è™Ÿï¼Œæ¯ä¸€å€‹æ™‚é–“é»RNNçš„è¼¸å‡ºé™¤äº†å¯ä»¥æ˜¯vocabularyè£¡é¢çš„å­—ä»¥å¤–ï¼Œé‚„å¯ä»¥æ˜¯<code class="language-plaintext highlighter-rouge">blank</code>ï¼Œå¯«ä½œ<code class="language-plaintext highlighter-rouge">-</code>ã€‚</p>

<p><img src="./CTC_model_architecture.png" alt="CTC Model Architecture" /></p>

<p>å‡å¦‚èªªæˆ‘å€‘æ‹¿ä¸€æ®µèªéŸ³è¨Šè™Ÿ\(X=[x_1, x_2, ..., x_T]\)è¼¸å…¥åˆ°LSTMè£¡é¢ï¼Œæ¯å€‹æ™‚é–“é»LSTMéƒ½æœƒè¼¸å‡ºä¸€å€‹é•·åº¦ç‚º\(L+1\)çš„å‘é‡\(y_t=[y_t^{-}, y_t^1, ..., y_t^L]\)ï¼Œå…¶ä¸­\(L\)è¡¨ç¤ºvocabularyçš„å¤§å°ï¼Œé›–ç„¶æˆ‘å€‘çŸ¥é“é€™æ•´æ®µèªéŸ³è¨Šè™Ÿ\(X\)æ‰€å°æ‡‰åˆ°çš„æ–‡å­—æ˜¯\(Z=[z_1, z_2, ..., z_U]\)ï¼Œä½†å› ç‚ºLSTMæ•´å€‹è¼¸å‡ºçš„é•·åº¦è·Ÿè¼¸å…¥é•·åº¦ç›¸åŒï¼Œéƒ½æ˜¯\(T\)ï¼Œè€Œæ–‡å­—çš„é•·åº¦æ˜¯\(U\)ï¼Œå…©è€…å°ä¸èµ·ä¾†ï¼Œæ²’è¾¦æ³•ç›´æ¥ä¸€å°ä¸€å°æ‡‰åšgradient descentï¼Œæ‰€ä»¥CTCåœ¨é€™è£¡ä½¿ç”¨äº†<code class="language-plaintext highlighter-rouge">blank</code>ä¸¦å°‡\(Z\)è£¡é¢çš„æ–‡å­—é‡è¤‡ä¾†æŠŠ\(Z\)çš„é•·åº¦æ“´å……åˆ°è·Ÿ\(T\)ä¸€æ¨£ï¼Œä¸¦æ­é…ä¸€å€‹mapping function \(B()\)ä¾†æŠŠæ‰€æœ‰<code class="language-plaintext highlighter-rouge">blank</code>å’Œç›¸é„°çš„é‡è¤‡è¼¸å‡ºå»é™¤æ‰ï¼Œä¿ç•™ä¸ç›¸é„°çš„è¼¸å‡ºã€‚</p>

<p>èˆ‰ä¾‹ä¾†èªªï¼Œå‡è¨­ä»Šå¤©æ”¾é€²LSTMçš„\(X\)é•·åº¦ç‚º4ï¼Œè€Œå°æ‡‰çš„\(Z\)ç‚º\([è®š, å•¦]\)ï¼Œæˆ‘å€‘å¯ä»¥é€éåŠ å…¥<code class="language-plaintext highlighter-rouge">-</code>æˆ–é‡è¤‡\(Z\)è£¡é¢çš„å­—ä¾†è®“é•·åº¦è®Šç‚º4ï¼Œä¹‹å¾Œå†è®“\(B()\)å¹«æˆ‘å€‘æŠŠä¿®æ”¹éçš„è¼¸å‡º\(Z^*\)çš„è¼¸å‡ºå°å›\(Z\)ï¼Œäº¦å³</p>

\[B([-, è®š, å•¦, å•¦])=[è®š, å•¦] \\
B([è®š, è®š, å•¦, å•¦])=[è®š, å•¦] \\
B([-, è®š, å•¦, -])=[è®š, å•¦]\]

<p>å…¶ä¸­æ¯ä¸€å€‹\(B()\)çš„è¼¸å…¥\([-, è®š, å•¦, å•¦]\)ã€\([è®š, è®š, å•¦, å•¦]\)ç­‰éƒ½å¯ä»¥æ˜¯LSTMç”¨ä¾†å­¸ç¿’çš„ç›®æ¨™ï¼Œè€Œæˆ‘å€‘æœƒé€é<a href="https://en.wikipedia.org/wiki/Forward%E2%80%93backward_algorithm">Forward-backward Algorithm</a>ä¾†å°‡æ‰€æœ‰å¯èƒ½çš„çµ„åˆéƒ½å›Šæ‹¬é€²ä¾†ã€‚</p>

<p>æˆ‘å€‘å°‡LSTMæ¯ä¸€å€‹æ™‚é–“é»çš„è¼¸å‡º\(y_t\)æ”¤é–‹ä¾†ï¼Œä¸¦å–å‡ºæ‰€æœ‰åœ¨\(Z\)è£¡é¢æ–‡å­—çš„æ©Ÿç‡ï¼Œå†åœ¨æ¯å€‹labelä¹‹é–“éƒ½æ’å…¥<code class="language-plaintext highlighter-rouge">blank</code>çš„ç¬¦è™Ÿï¼Œå¦‚ä¸Šåœ–ä¸­çš„ä¸ŠåŠéƒ¨ã€‚åœ¨é€™é‚Šï¼Œæˆ‘å€‘é™å®šæ¯å€‹æ™‚é–“é»çš„è½‰ç§»åªèƒ½å¾€å³é‚Šæˆ–å³ä¸Šè§’èµ°ï¼Œä¸èƒ½å¾€å³ä¸‹æˆ–å·¦é‚Šèµ°ï¼Œå¦‚æ­¤ä¾¿å¯ä»¥é€éForward Algorithmå°‡æœ€å¾Œä¸€å€‹æ™‚é–“é»çš„æ©Ÿç‡ç¸½å’Œä¾†ç•¶ä½œè§€å¯Ÿåˆ°è¼¸å‡º\(Z\)çš„æ©Ÿç‡\(P(Z\vert X)\)ï¼Œå…¶ä¸­æ¯ä¸€å€‹å¯èƒ½çš„\(Z^*\)çš„æ©Ÿç‡å¯ä»¥è¢«è¡¨ç¤ºç‚º</p>

\[P(Z^*\vert X)=\coprod\limits_{t=1}\limits^{T}y_t^{Z^*_t}\]

<p>è€Œ\(P(Z\vert X)\)å¯ä»¥è¢«è¡¨ç¤ºç‚º</p>

\[P(Z\vert X)=\sum\limits_{Z^* \in B^{-1}(Z)}P(Z^*\vert X)\]

<p>æœ€å¾Œå°±å¯ä»¥é€éåº•ä¸‹çš„loss functionåšè¨“ç·´äº†</p>

\[\mathcal{L}_{CTC}=-\sum\limits_{\forall(X,Z^*)\in\theta}\ln P(Z^*\vert X)\]

<p>è¨“ç·´å®ŒCTCä»¥å¾Œï¼Œå°±å¯ä»¥ç›´æ¥å°‡è²éŸ³è¨Šè™Ÿé¤µé€²å»ï¼Œé¸æ“‡æ¯ä¸€å€‹æ™‚é–“é»æœ€å¤§çš„æ–‡å­—æ­é…\(B()\)ç•¶ä½œæ˜¯èªéŸ³è¾¨è­˜çš„è¼¸å‡ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨beam searchä¾†å¢é€²performanceã€‚</p>

<h2 id="rnn-transducerrnn-t">RNN Transducerï¼ˆRNN-Tï¼‰</h2>

<p>åœ¨ä¸Šè¿°CTCçš„éƒ¨åˆ†è£¡é¢ï¼Œæˆ‘å€‘é€éåœ¨labelè£¡é¢åŠ å…¥<code class="language-plaintext highlighter-rouge">blank</code>ä¾†è®“ä¸²æµèªéŸ³è¾¨è­˜æˆç‚ºå¯èƒ½ï¼Œç„¶è€Œåœ¨CTCè£¡é¢ï¼Œæ¯ä¸€å€‹æ™‚é–“é»çš„è¼¸å‡ºè·Ÿä¸‹ä¸€å€‹æ™‚é–“é»çš„è¼¸å‡ºæ˜¯äº’ç›¸ç¨ç«‹çš„ï¼Œé€™æœƒä½¿å¾—å¾Œé¢æ™‚é–“çš„è¦è¼¸å‡ºçš„æ™‚å€™å› ç‚ºä¸ç¢ºå®šå‰é¢è¼¸å‡ºéäº†æ²’é€ æˆçµå·´çš„ç¾è±¡ï¼Œè€ŒRNN-Tæ‰€åšçš„æ”¹å‹•ä¾¿æ˜¯å°‡ä¸Šä¸€å€‹æ™‚é–“é»çš„è¼¸å‡ºæ‹‰å›ä¾†ç•¶ä½œæ˜¯ä¸‹ä¸€å€‹æ™‚é–“é»çš„è¼¸å…¥ï¼Œä¸¦æ”¹è®Špredictæ–‡å­—çš„æ–¹å¼ã€‚</p>

<p>åœ¨å‰é¢CTCçš„éƒ¨åˆ†è£¡ï¼Œæ¯ä¸€å€‹æ™‚é–“é»LSTMæœƒåƒä¸€å€‹å‘é‡é€²ä¾†ï¼Œè¼¸å‡ºä¸€å€‹æ–‡å­—ï¼Œä½†åœ¨RNN-Tè£¡é¢ï¼Œæ¯ä¸€å€‹æ™‚é–“é»LSTMæœƒé‡è¤‡åƒä¸€åŒå€‹å‘é‡ï¼Œç›´åˆ°predictå‡º<code class="language-plaintext highlighter-rouge">NULL</code>ä»¥å¾Œæ‰æœƒåƒä¸‹ä¸€å€‹è¼¸å…¥ã€‚</p>

<pre><code class="language-mermaid">graph BT;
    LSTM1[LSTM]
    LSTM2[LSTM]
    LSTM3[LSTM]
    LSTM4[LSTM]
    LSTM5[LSTM]
    LSTM6[LSTM]
    i1[i1]
    i2[i2]
    i3[i3]
    o1[c]
    o2[a]
    o3[NULL]
    o4[t]
    o5[NULL]
    o6[NULL]
    i1--&gt;LSTM1
    LSTM1--&gt;o1
    i1--&gt;LSTM2
    LSTM2--&gt;o2
    i1--&gt;LSTM3
    LSTM3--&gt;o3
    i2--&gt;LSTM4
    LSTM4--&gt;o4
    i2--&gt;LSTM5
    LSTM5--&gt;o5
    i3--&gt;LSTM6
    LSTM6--&gt;o6
</code></pre>

<p>æ‰€ä»¥ç•¶è¼¸å…¥çš„èªéŸ³embeddingé•·åº¦ç‚º\(T\)æ™‚ï¼Œæˆ‘å€‘å°±æœƒåœ¨å°æ‡‰çš„ç­”æ¡ˆè£¡é¢åŠ å…¥\(T\)å€‹<code class="language-plaintext highlighter-rouge">NULL</code>ï¼Œè‡³æ–¼è¦å¦‚ä½•å°‡\(T\)å€‹<code class="language-plaintext highlighter-rouge">NULL</code>æ”¾é€²å»å°±è·ŸCTCçš„æ–¹å¼ç›¸åŒã€‚</p>

<p>RNN-Té™¤äº†predictæ–¹å¼çš„ä¸åŒï¼Œé‚„æœ‰åœ¨è¼¸å‡ºçš„æœ€å¾Œæ”¾ä¸€å€‹language modelï¼Œä¸¦æŠŠlanguage modelçš„è¼¸å‡ºèˆ‡ä¸‹ä¸€å€‹æ™‚é–“é»çš„è¼¸å…¥ä¸€ç”¨é¤µé€²LSTMç•¶ä¸­ï¼Œå¯ä»¥çœ‹<a href="https://youtu.be/CGuLuBaLIeI?t=1870">å½±ç‰‡ä¸­çš„æ¶æ§‹</a>ä¾†ç²å¾—æ¯”è¼ƒæ¸…æ¥šçš„äº†è§£ã€‚</p>

<p>ç¸½çš„ä¾†èªªï¼ŒRNN-Tçš„æ¶æ§‹å¦‚ä¸‹åœ–ï¼Œç”±ä¸‰å€‹éƒ¨åˆ†æ‰€æ§‹æˆæˆï¼š</p>

<ul>
  <li>Encoderï¼šå¯ä»¥æƒ³æˆæ˜¯acoustic modelï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ¶æ§‹åœ–ä¸­çš„LSTMï¼Œè¨ˆç®—èªéŸ³è¨Šè™Ÿçš„ç‰¹å¾µã€‚</li>
  <li>Prediction Networkï¼šå¯ä»¥æƒ³æˆæ˜¯language modelï¼Œåœ¨<a href="https://youtu.be/CGuLuBaLIeI?t=1870">å½±ç‰‡ä¸­çš„æ¶æ§‹</a>è£¡é¢æœ€ä¸Šå±¤çš„éƒ¨åˆ†ã€‚</li>
  <li>Joint Networkï¼šç¶œåˆEncoderå’ŒPrediction Networkçš„è¼¸å‡ºæ±ºå®šæœ€å¾Œçš„æ–‡å­—æ˜¯ä»€éº¼ï¼Œåœ¨<a href="https://youtu.be/CGuLuBaLIeI?t=1870">å½±ç‰‡ä¸­çš„æ¶æ§‹</a>ä¸­æ˜¯é»ƒè‰²çš„æ¡†æ¡†ã€‚</li>
</ul>

<p><img src="https://www.researchgate.net/publication/335044103/figure/fig3/AS:789632253952000@1565274408664/Recurrent-neural-network-RNN-transducer-structure-38.png" alt="RNN-T Overview" /></p>

<h2 id="neural-transducer">Neural Transducer</h2>

<p>Neural Transducerå’ŒRNN-Tçš„ä½œæ³•é¡ä¼¼ï¼Œèˆ‡RNN-Tä¸åŒçš„åœ°æ–¹åœ¨æ–¼ï¼Œè¼¸å…¥å¾å–®ä¸€å€‹acoustic featureè®Šæˆå¤šå€‹acoustic featureï¼Œä¸¦åœ¨å…¶ä¸­åŠ å…¥attentionçš„æ©Ÿåˆ¶ã€‚</p>

<p><img src="./neural_transducer_architecture.png" alt="Neural Transducer Architecture" /></p>

<p>åœ¨neural transducerè£¡ï¼Œè¼¸å…¥é€²ä¾†çš„acoustic featureå€‘æœƒç”¨å›ºå®šå¤§å°\(W\)çš„windowåˆ‡é–‹ï¼Œåˆ†æˆå¤šå€‹blockï¼Œæ¯æ¬¡æ¨¡å‹æœƒæ ¹æ“šç•¶å‰è¼¸å…¥çš„blockä¸­çš„acoustic featureä¾†åšpredictï¼Œç›´åˆ°model predictå‡º<code class="language-plaintext highlighter-rouge">NULL</code>ä»¥å¾Œæ‰æœƒè¼¸å…¥ä¸‹ä¸€å€‹blockã€‚</p>

<h2 id="monotonic-chunkwise-attentionmocha">Monotonic Chunkwise Attentionï¼ˆMoChAï¼‰</h2>

<p>MoChAåˆå°neural transduceråšäº†ä¸€äº›è®Šå½¢ï¼Œåœ¨neural transducerè£¡ä½¿ç”¨å›ºå®šå¤§å°çš„\(W\)ä¾†å°acoustic featureåˆ†å¡Šï¼Œè€ŒMoChAæƒ³è®“modelä¾†è‡ªå·±æ±ºå®šblockè¦æ€éº¼åˆ‡ã€‚</p>

<p><img src="./mocha_attention.png" alt="MoChA Attention" /></p>

<p>åœ¨ä¸Šåœ–(a)æ˜¯ä¸€èˆ¬çš„soft attentionï¼Œåœ¨è¼¸å‡º\(y\)çš„æ™‚å€™æœƒå°æ‰€æœ‰çš„inputç®—attentionã€‚</p>

<p>åœ–(b)æ˜¯monotonic attentionï¼Œç”±modelä¾†æ±ºå®šè¦attendå¤šå°‘inputï¼Œ\(\otimes\)æ˜¯æœ‰è¢«é¸ä¸­çš„inputï¼Œè€Œ\(\bullet\)æ˜¯æ±ºå®šè¦åœæ­¢çš„åœ°æ–¹ï¼Œä¸‹ä¸€å€‹æ™‚é–“é»æœƒå¾ä¸Šä¸€å€‹æ™‚é–“é»åœæ­¢çš„åœ°æ–¹é–‹å§‹å¾€å¾Œé æ¸¬è©²è¦åœ¨å“ªå€‹inputåœä¸‹ä¾†ã€‚</p>

<p>åœ–(c)æ˜¯MoChAï¼Œèˆ‡åœ–(b)çš„ä½œæ³•é¡ä¼¼ï¼Œä½†åœ¨é€™é‚Šæœƒè¨­å®šä¸€å€‹window size \(W\)ï¼Œåœ¨åœä¸‹ä¾†çš„åœ°æ–¹å¾€å‰æ¡†\(W\)å€‹featureä¾†ç•¶ä½œæ¨¡å‹çš„è¼¸å…¥ï¼Œåœ¨åœ–ä¸­çš„ä¾‹å­æ˜¯è¨­å®š\(W=3\)ã€‚</p>

<h2 id="ç¸½çµ">ç¸½çµ</h2>

<p>åœ¨é€™ç¯‡æ–‡ç« è£¡é¢ä»‹ç´¹äº†ä¸€äº›End-to-endçš„æ–¹å¼ä¾†è¨“ç·´èªéŸ³è¾¨è­˜çš„æ¨¡å‹ï¼Œå®ƒå€‘çš„è¾¨è­˜éŒ¯èª¤ç‡è·Ÿå…ˆå‰çš„HMM-DNN hybridæ¨¡å‹ç›¸è¿‘ï¼Œå¦‚æœè³‡æ–™é‡å¤ å¤§çš„è©±ï¼Œend-to-endçš„æ¨¡å‹é‚„å¯ä»¥æŠŠéŒ¯èª¤ç‡å†èª¿é™ï¼Œå¯ä»¥æ ¹æ“šæ“æœ‰çš„è³‡æ–™é‡ä¾†æ±ºå®šè¦ä½¿ç”¨å“ªä¸€ç¨®æ–¹å¼ä¾†è£½ä½œä½ çš„èªéŸ³è¾¨è­˜æ¨¡å‹ã€‚</p>

<h2 id="åƒè€ƒè³‡æ–™">åƒè€ƒè³‡æ–™</h2>

<ol>
  <li><a href="https://www.youtube.com/watch?v=CGuLuBaLIeI">[DLHLP 2020] Speech Recognition (3/7) - CTC, RNN-T and more</a></li>
  <li><a href="https://arxiv.org/pdf/1508.01211.pdf">Listen, Attend and Spell</a></li>
  <li><a href="https://www.researchgate.net/figure/Recurrent-neural-network-RNN-transducer-structure-38_fig3_335044103">Figure 4 - available via license: Creative Commons Attribution 4.0 International</a></li>
  <li><a href="https://arxiv.org/pdf/1511.04868.pdf">A Neural Transducer</a></li>
  <li><a href="https://arxiv.org/pdf/1712.05382.pdf">Monotonic Chunkwise Attention</a></li>
</ol>]]></content><author><name>Your Name</name></author><category term="Speech-Recognition" /><summary type="html"><![CDATA[åœ¨å…ˆå‰çš„æ–‡ç« è£¡é ­ï¼Œä»‹ç´¹äº†åœ¨æ·±åº¦å­¸ç¿’è“¬å‹ƒç™¼å±•ä¹‹å‰ï¼ŒèªéŸ³è¾¨è­˜å¤§æ¦‚æ˜¯å¦‚ä½•é”æˆçš„ï¼Œè€Œé€™ç¯‡æ–‡ç« æœƒç°¡å–®ä»‹ç´¹ä¸€ä¸‹ï¼Œåœ¨åŠ å…¥äº†æ·±åº¦å­¸ç¿’ä»¥å¾Œï¼ŒèªéŸ³è¾¨è­˜çš„æŠ€è¡“æœ‰äº†ä»€éº¼æ¨£çš„æ›´å‹•ã€‚]]></summary></entry></feed>